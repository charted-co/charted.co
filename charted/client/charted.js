/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.22 Copyright (c) 2010-2015, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

var requirejs,require,define;(function(global){function isFunction(e){return ostring.call(e)==="[object Function]"}function isArray(e){return ostring.call(e)==="[object Array]"}function each(e,t){if(e){var n;for(n=0;n<e.length;n+=1)if(e[n]&&t(e[n],n,e))break}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1;n-=1)if(e[n]&&t(e[n],n,e))break}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,i){if(n||!hasProp(e,i))r&&typeof t=="object"&&t&&!isArray(t)&&!isFunction(t)&&!(t instanceof RegExp)?(e[i]||(e[i]={}),mixin(e[i],t,n,r)):e[i]=t}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function m(e){var t,n;for(t=0;t<e.length;t++){n=e[t];if(n===".")e.splice(t,1),t-=1;else if(n===".."){if(t===0||t===1&&e[2]===".."||e[t-1]==="..")continue;t>0&&(e.splice(t-1,2),t-=2)}}}function g(e,t,n){var r,i,s,u,a,f,l,c,h,p,d,v,g=t&&t.split("/"),y=o.map,b=y&&y["*"];e&&(e=e.split("/"),l=e.length-1,o.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),e[0].charAt(0)==="."&&g&&(v=g.slice(0,g.length-1),e=v.concat(e)),m(e),e=e.join("/"));if(n&&y&&(g||b)){s=e.split("/");e:for(u=s.length;u>0;u-=1){f=s.slice(0,u).join("/");if(g)for(a=g.length;a>0;a-=1){i=getOwn(y,g.slice(0,a).join("/"));if(i){i=getOwn(i,f);if(i){c=i,h=u;break e}}}!p&&b&&getOwn(b,f)&&(p=getOwn(b,f),d=u)}!c&&p&&(c=p,h=d),c&&(s.splice(0,h,c),e=s.join("/"))}return r=getOwn(o.pkgs,e),r?r:e}function y(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===r.contextName)return t.parentNode.removeChild(t),!0})}function b(e){var t=getOwn(o.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),r.require.undef(e),r.makeRequire(null,{skipMap:!0})([e]),!0}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e,t,n,i){var s,o,u,a,f=null,l=t?t.name:null,h=e,p=!0,m="";return e||(p=!1,e="_@r"+(d+=1)),a=w(e),f=a[0],e=a[1],f&&(f=g(f,l,i),o=getOwn(c,f)),e&&(f?o&&o.normalize?m=o.normalize(e,function(e){return g(e,l,i)}):m=e.indexOf("!")===-1?g(e,l,i):e:(m=g(e,l,i),a=w(m),f=a[0],m=a[1],n=!0,s=r.nameToUrl(m))),u=f&&!o&&!n?"_unnormalized"+(v+=1):"",{prefix:f,name:m,parentMap:t,unnormalized:!!u,url:s,originalName:h,isDefine:p,id:(f?f+"!"+m:m)+u}}function S(e){var t=e.id,n=getOwn(u,t);return n||(n=u[t]=new r.Module(e)),n}function x(e,t,n){var r=e.id,i=getOwn(u,r);hasProp(c,r)&&(!i||i.defineEmitComplete)?t==="defined"&&n(c[r]):(i=S(e),i.error&&t==="error"?n(i.error):i.on(t,n))}function T(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=getOwn(u,t);n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function N(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];typeof t=="string"&&(r.defQueueMap[t]=!0),l.push(e)}),globalDefQueue=[])}function C(e){delete u[e],delete a[e]}function k(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,each(e.depMaps,function(r,i){var s=r.id,o=getOwn(u,s);o&&!e.depMatched[i]&&!n[s]&&(getOwn(t,s)?(e.defineDep(i,c[s]),e.check()):k(o,t,n))}),n[r]=!0)}function L(){var e,n,i=o.waitSeconds*1e3,u=i&&r.startTime+i<(new Date).getTime(),f=[],l=[],c=!1,h=!0;if(t)return;t=!0,eachProp(a,function(e){var t=e.map,r=t.id;if(!e.enabled)return;t.isDefine||l.push(e);if(!e.error)if(!e.inited&&u)b(r)?(n=!0,c=!0):(f.push(r),y(r));else if(!e.inited&&e.fetched&&t.isDefine){c=!0;if(!t.prefix)return h=!1}});if(u&&f.length)return e=makeError("timeout","Load timeout for modules: "+f,null,f),e.contextName=r.contextName,T(e);h&&each(l,function(e){k(e,{},{})}),(!u||n)&&c&&(isBrowser||isWebWorker)&&!s&&(s=setTimeout(function(){s=0,L()},50)),t=!1}function A(e){hasProp(c,e[0])||S(E(e[0],null,!0)).init(e[1],e[2])}function O(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function M(e){var t=e.currentTarget||e.srcElement;return O(t,r.onScriptLoad,"load","onreadystatechange"),O(t,r.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function _(){var e;N();while(l.length){e=l.shift();if(e[0]===null)return T(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));A(e)}r.defQueueMap={}}var t,n,r,i,s,o={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},u={},a={},f={},l=[],c={},h={},p={},d=1,v=1;return i={require:function(e){return e.require?e.require:e.require=r.makeRequire(e.map)},exports:function(e){e.usingExports=!0;if(e.map.isDefine)return e.exports?c[e.map.id]=e.exports:e.exports=c[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(o.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},n=function(e){this.events=getOwn(f,e.id)||{},this.map=e,this.shim=getOwn(o.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},n.prototype={init:function(e,t,n,r){r=r||{};if(this.inited)return;this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check()},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(this.fetched)return;this.fetched=!0,r.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();r.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))},load:function(){var e=this.map.url;h[e]||(h[e]=!0,r.load(this.map.id,e))},check:function(){if(!this.enabled||this.enabling)return;var e,t,n=this.map.id,i=this.depExports,s=this.exports,o=this.factory;if(!this.inited)hasProp(r.defQueueMap,n)||this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(o)){try{s=r.execCb(n,o,i,s)}catch(u){e=u}this.map.isDefine&&s===undefined&&(t=this.module,t?s=t.exports:this.usingExports&&(s=this.exports));if(e){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",T(this.error=e);typeof console!="undefined"&&console.error?console.error(e):req.onError(e)}}else s=o;this.exports=s;if(this.map.isDefine&&!this.ignore){c[n]=s;if(req.onResourceLoad){var a=[];each(this.depMaps,function(e){a.push(e.normalizedMap||e)}),req.onResourceLoad(r,this.map,a)}}C(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var e=this.map,t=e.id,n=E(e.prefix);this.depMaps.push(n),x(n,"defined",bind(this,function(n){var i,s,a,f=getOwn(p,this.map.id),l=this.map.name,c=this.map.parentMap?this.map.parentMap.name:null,h=r.makeRequire(e.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){n.normalize&&(l=n.normalize(l,function(e){return g(e,c,!0)})||""),s=E(e.prefix+"!"+l,this.map.parentMap),x(s,"defined",bind(this,function(e){this.map.normalizedMap=s,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),a=getOwn(u,s.id),a&&(this.depMaps.push(s),this.events.error&&a.on("error",bind(this,function(e){this.emit("error",e)})),a.enable());return}if(f){this.map.url=r.nameToUrl(f),this.load();return}i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(u,function(e){e.map.id.indexOf(t+"_unnormalized")===0&&C(e.map.id)}),T(e)}),i.fromText=bind(this,function(n,s){var u=e.name,a=E(u),f=useInteractive;s&&(n=s),f&&(useInteractive=!1),S(a),hasProp(o.config,t)&&(o.config[u]=o.config[t]);try{req.exec(n)}catch(l){return T(makeError("fromtexteval","fromText eval for "+t+" failed: "+l,l,[t]))}f&&(useInteractive=!0),this.depMaps.push(a),r.completeLoad(u),h([u],i)}),n.load(e.name,h,i,o)})),r.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){a[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,s,o;if(typeof e=="string"){e=E(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,o=getOwn(i,e.id);if(o){this.depExports[t]=o(this);return}this.depCount+=1,x(e,"defined",bind(this,function(e){if(this.undefed)return;this.defineDep(t,e),this.check()})),this.errback?x(e,"error",bind(this,this.errback)):this.events.error&&x(e,"error",bind(this,function(e){this.emit("error",e)}))}n=e.id,s=u[n],!hasProp(i,n)&&s&&!s.enabled&&r.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(u,e.id);t&&!t.enabled&&r.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),e==="error"&&delete this.events[e]}},r={config:o,contextName:e,registry:u,defined:c,urlFetched:h,defQueue:l,defQueueMap:{},Module:n,makeModuleMap:E,nextTick:req.nextTick,onError:T,configure:function(e){e.baseUrl&&e.baseUrl.charAt(e.baseUrl.length-1)!=="/"&&(e.baseUrl+="/");var t=o.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){n[t]?(o[t]||(o[t]={}),mixin(o[t],e,!0,!0)):o[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(p[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,n){isArray(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=r.makeShimExports(e)),t[n]=e}),o.shim=t),e.packages&&each(e.packages,function(e){var t,n;e=typeof e=="string"?{name:e}:e,n=e.name,t=e.location,t&&(o.paths[n]=e.location),o.pkgs[n]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(u,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=E(t,null,!0))}),(e.deps||e.callback)&&r.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,n){function s(o,a,f){var l,h,p;return n.enableBuildCallback&&a&&isFunction(a)&&(a.__requireJsBuild=!0),typeof o=="string"?isFunction(a)?T(makeError("requireargs","Invalid require call"),f):t&&hasProp(i,o)?i[o](u[t.id]):req.get?req.get(r,o,t,s):(h=E(o,t,!1,!0),l=h.id,hasProp(c,l)?c[l]:T(makeError("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(_(),r.nextTick(function(){_(),p=S(E(null,t)),p.skipMap=n.skipMap,p.init(o,a,f,{enabled:!0}),L()}),s)}return n=n||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var n,i=e.lastIndexOf("."),s=e.split("/")[0],o=s==="."||s==="..";return i!==-1&&(!o||i>1)&&(n=e.substring(i,e.length),e=e.substring(0,i)),r.nameToUrl(g(e,t&&t.id,!0),n,!0)},defined:function(e){return hasProp(c,E(e,t,!1,!0).id)},specified:function(e){return e=E(e,t,!1,!0).id,hasProp(c,e)||hasProp(u,e)}}),t||(s.undef=function(e){N();var n=E(e,t,!0),i=getOwn(u,e);i.undefed=!0,y(e),delete c[e],delete h[n.url],delete f[e],eachReverse(l,function(t,n){t[0]===e&&l.splice(n,1)}),delete r.defQueueMap[e],i&&(i.events.defined&&(f[e]=i.events),C(e))}),s},enable:function(e){var t=getOwn(u,e.id);t&&S(e).enable()},completeLoad:function(e){var t,n,i,s=getOwn(o.shim,e)||{},a=s.exports;N();while(l.length){n=l.shift();if(n[0]===null){n[0]=e;if(t)break;t=!0}else n[0]===e&&(t=!0);A(n)}r.defQueueMap={},i=getOwn(u,e);if(!t&&!hasProp(c,e)&&i&&!i.inited){if(o.enforceDefine&&(!a||!getGlobal(a))){if(b(e))return;return T(makeError("nodefine","No define call for "+e,null,[e]))}A([e,s.deps||[],s.exportsFn])}L()},nameToUrl:function(e,t,n){var i,s,u,a,f,l,c,h=getOwn(o.pkgs,e);h&&(e=h),c=getOwn(p,e);if(c)return r.nameToUrl(c,t,n);if(req.jsExtRegExp.test(e))f=e+(t||"");else{i=o.paths,s=e.split("/");for(u=s.length;u>0;u-=1){a=s.slice(0,u).join("/"),l=getOwn(i,a);if(l){isArray(l)&&(l=l[0]),s.splice(0,u,l);break}}f=s.join("/"),f+=t||(/^data\:|\?/.test(f)||n?"":".js"),f=(f.charAt(0)==="/"||f.match(/^[\w\+\.\-]+:/)?"":o.baseUrl)+f}return o.urlArgs?f+((f.indexOf("?")===-1?"?":"&")+o.urlArgs):f},load:function(e,t){req.load(r,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if(e.type==="load"||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=M(e);r.completeLoad(t.id)}},onScriptError:function(e){var t=M(e);if(!b(t.id)){var n=[];return eachProp(u,function(e,r){r.indexOf("_@r")!==0&&each(e.depMaps,function(e){return e.id===t.id&&n.push(r),!0})}),T(makeError("scripterror",'Script error for "'+t.id+(n.length?'", needed by: '+n.join(", "):'"'),e,[t.id]))}}},r.require=r.makeRequire(),r}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(e){if(e.readyState==="interactive")return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=typeof window!="undefined"&&typeof navigator!="undefined"&&!!window.document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(e,t,n,r){var i,s,o=defContextName;return!isArray(e)&&typeof e!="string"&&(s=e,isArray(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),i=getOwn(contexts,o),i||(i=contexts[o]=req.s.newContext(o)),s&&i.configure(s),i.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick=typeof setTimeout!="undefined"?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var r=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return r.type=e.scriptType||"text/javascript",r.charset="utf-8",r.async=!0,r},req.load=function(e,t,n){var r=e&&e.config||{},i;if(isBrowser)return i=req.createNode(r,t,n),r.onNodeCreated&&r.onNodeCreated(i,r,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),i.attachEvent&&!(i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)):(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{importScripts(n),e.completeLoad(t)}catch(s){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,s,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){head||(head=e.parentNode),dataMain=e.getAttribute("data-main");if(dataMain)return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var r,i;typeof e!="string"&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(n.length===1?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")])),i?(i.defQueue.push([e,t,n]),i.defQueueMap[e]=!0):globalDefQueue.push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),define("requireLib",function(){}),define("shared/sha1",["exports"],function(e){function t(e){var t=arguments.length<=1||arguments[1]===undefined?!1:arguments[1];e=s(e);var o=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);var u=e.length/4+2,a=Math.ceil(u/16),l=new Array(a);for(var c=0;c<a;c++){l[c]=new Array(16);for(var h=0;h<16;h++)l[c][h]=e.charCodeAt(c*64+h*4)<<24|e.charCodeAt(c*64+h*4+1)<<16|e.charCodeAt(c*64+h*4+2)<<8|e.charCodeAt(c*64+h*4+3)}l[a-1][14]=(e.length-1)*8/Math.pow(2,32),l[a-1][14]=Math.floor(l[a-1][14]),l[a-1][15]=(e.length-1)*8&4294967295;var p=1732584193,d=4023233417,v=2562383102,m=271733878,g=3285377520,y=new Array(80),b,w,E,S,x;for(var c=0;c<a;c++){for(var T=0;T<16;T++)y[T]=l[c][T];for(var T=16;T<80;T++)y[T]=r(y[T-3]^y[T-8]^y[T-14]^y[T-16],1);b=p,w=d,E=v,S=m,x=g;for(var T=0;T<80;T++){var N=Math.floor(T/20),C=r(b,5)+n(N,w,E,S)+x+o[N]+y[T]&4294967295;x=S,S=E,E=r(w,30),w=b,b=C}p=p+b&4294967295,d=d+w&4294967295,v=v+E&4294967295,m=m+S&4294967295,g=g+x&4294967295}var k=i(p)+i(d)+i(v)+i(m)+i(g);return t?k.slice(0,7):k}function n(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function r(e,t){return e<<t|e>>>32-t}function i(e){var t="",n;for(var r=7;r>=0;r--)n=e>>>r*4&15,t+=n.toString(16);return t}function s(e){return unescape(encodeURIComponent(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=t}),define("shared/utils",["exports","./sha1"],function(e,t){function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){return(0,n.default)(JSON.stringify(e),!0)}function s(e){var t=/\/(?:c|embed)\/(\w+)(?:|\?.*)?/.exec(e);return t?t[1]:null}function o(e){return Math.floor(Math.log(e)/Math.LN10,0)}function u(e){var t=e.slice(1);if(!t)return{};var n=t.split("&"),r={};return n.forEach(function(e){var t=e.split("=");t.length===1?r.data=JSON.parse(decodeURIComponent(t[0])):r[t[0]]=t[1]}),r}function a(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function f(e){return Number(String(e).replace(/[^0-9\.\-]/g,"")||0)}function l(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function c(e,t){var n=2,r=3,i=o(Math.abs(t[1])),s=o(Math.abs(t[0])),u=Math.abs(i-s),a=Math.max(i,s),f=u<=n?a:o(Math.abs(e));return h(e,f,r)}function h(e,t,n){if(t<-3)return e.toString();if(t<3){var r=Math.max(n-t-1,0);return e.toFixed(r)}var i=["K","M","B","T"],s=Math.min(Math.floor(t/3),i.length),o=Math.pow(1e3,s),u=Math.max(0,s*3-t+n-1),a=i[s-1],f=l((e/o).toFixed(u));return f+a}function p(e,t){var n=[Math.min(0,e[0]),Math.max(0,e[1])],r=Math.max(n[1]-n[0]),i=40,s=5,u=Math.floor(Math.min(t/i,s)),a=r/u,f=Math.pow(10,o(a)+1),l=f;[2,4,5,10].forEach(function(e){var t=f/e;l=t>=a?t:l});var c=o(Math.abs(l)),p=o(Math.max(Math.abs(n[0]),Math.abs(n[1]))),d=l/Math.pow(10,c)===2.5?1:0,v=1+p-c+d,m=[],g=Math.ceil(n[0]/l)*l,y=g;while(y<e[1]+l){var b={value:y,displayString:y===0?"0":h(y,p,v),rawString:y===0?"0":h(y,Math.min(0,p),0)};y+=l,m.push(b)}return m}function d(e){var t=0,n=0;return e.forEach(function(e,r){var i=!e||e.toLowerCase()==="null";i&&r===t?t=r+1:i||(n=r)}),[t,n]}function v(e){var t=e.substring(0,e.indexOf("?")),n=t.split(".").pop();return n.toLowerCase()}Object.defineProperty(e,"__esModule",{value:!0}),e.getFileExtension=e.getTrimmedExtent=e.getNiceIntervals=e.getRoundedValue=e.stringToNumber=e.camelToHyphen=e.parseQueryString=e.parseChartId=e.getChartId=undefined;var n=r(t);e.getChartId=i,e.parseChartId=s,e.parseQueryString=u,e.camelToHyphen=a,e.stringToNumber=f,e.getRoundedValue=c,e.getNiceIntervals=p,e.getTrimmedExtent=d,e.getFileExtension=v}),define("scripts/PageData",["exports","../shared/utils"],function(e,t){function r(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=r(t),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){var r=this;i(this,e);var s=t.shift(),o=t.map(function(e){return s.reduce(function(t,n,r){return t[n]=e[r],t},{})});s.length!=1?function(){var e=s.shift();r.indices=o.map(function(t){return t[e]})}():this.indices=o.map(function(e,t){return"Row "+(t+1)}),this.serieses=s.map(function(e,t){return{label:e,seriesIndex:t}}),this.data=s.map(function(e){return o.map(function(t,i){return{x:i,y:n.stringToNumber(t[e]),xLabel:r.indices[i],yRaw:t[e]}})})}return s(e,null,[{key:"fromJSON",value:function(r,i){var s=n.getFileExtension(r),o=s=="tsv"?d3.tsv.parseRows(i):d3.csv.parseRows(i);return new e(o)}}]),e}();e.default=o}),define("scripts/ChartData",["exports","../shared/utils","./PageData"],function(e,t,n){function i(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=i(n),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t,n){s(this,e),this._data=t.data.filter(function(e,t){return n.indexOf(t)>-1}),this._serieses=t.serieses.filter(function(e,t){return n.indexOf(t)>-1}),this._indices=t.indices,this.formatData()}return o(e,[{key:"formatData",value:function(){var t=this;this._data[0].forEach(function(e,n){var r=0,i=0;t._data.forEach(function(e,s){var o=t._data[s][n];o.ySeries=s,o.y<0?(r+=o.y,o.y0=r,o.y1=o.y0-o.y):(o.y0=i,o.y1=o.y0+o.y,i+=o.y)})})}},{key:"getFlattenedData",value:function(){return this._data.reduce(function(e,t){return e.concat(t)})}},{key:"getSerieses",value:function(){return this._serieses}},{key:"getSeries",value:function(t){return this._serieses[t]}},{key:"getDatum",value:function(t,n){return this._data[t][n]}},{key:"getSeriesLabels",value:function(){return this._serieses.map(function(e){return e.label})}},{key:"getSeriesIndices",value:function(){return this._serieses.map(function(e){return e.seriesIndex})}},{key:"getSeriesCount",value:function(){return this._serieses.length}},{key:"getUnstackedValuesAtIndex",value:function(t){return this._data.map(function(e){return e[t].y})}},{key:"getValuesForSeries",value:function(t){var n=this.getSeriesExtent(t);return this._data[t].slice(n[0],n[1]+1)}},{key:"getFirstDatum",value:function(t){var n=this.getSeriesExtent(t)[0];return this._data[t][n]}},{key:"getLastDatum",value:function(t){var n=this.getSeriesExtent(t)[1];return this._data[t][n]}},{key:"getSeriesExtent",value:function(n){var r=this._data[n].map(function(e){return e.yRaw});return(0,t.getTrimmedExtent)(r)}},{key:"getIndices",value:function(){return this._indices}},{key:"getIndexCount",value:function(){return this._indices.length}},{key:"getStackedExtent",value:function(){return d3.extent(this.getFlattenedData(),function(e){return e.y<0?e.y0:e.y1})}},{key:"getStackedExtentForIndex",value:function(t){var n=[0,0];return this._data.forEach(function(e){var r=e[t].y<0?0:1;n[r]+=e[t].y}),n}},{key:"getUnstackedExtent",value:function(){return d3.extent(this.getFlattenedData(),function(e){return e.y})}},{key:"getIndexExtent",value:function(){return[this._indices[0],this._indices[this._indices.length-1]]}}]),e}();e.default=u}),define("scripts/templates",["exports"],function(e){function t(){return'\n    <div class="page-settings">\n      <button class="option-item settings" title="Settings">\n        <span class="icon icon-settings"></span>\n      </button>\n\n      <div class="settings-popover popover">\n        <div class="page-options">\n          <a class="page-option-item download-data" title="Download data">\n            <span class="icon icon-download"></span>Download data\n          </a>\n\n          <button class="page-option-item toggle-color" title="Switch background color">\n            <span class="icon icon-color"></span>Switch background\n          </button>\n\n          <div class="grid-option"></div>\n\n          <button class="page-option-item get-embed" title="Get embed code">\n            <span class="icon icon-embed"></span>Get embed code\n          </button>\n\n          <div class="page-data-source">\n            <label>Update data source</label>\n            <div class="page-data-source-form">\n              <input class="data-source-url">\n              <button class="update-data-source">Go</button>\n            </div>\n          </div>\n        </div>\n\n        <a href="/" class="page-option-item">\n          <span class="icon icon-back"></span>Charted home\n        </a>\n      </div>\n    </div>\n  '}function n(e){var t='<script src="'+window.location.origin+'/embed.js" data-charted="'+e+'"></script>';return'\n    <div class="overlay-container">\n      <div class="overlay-content">\n        <h1 class="overlay-title">Embed this Charted page</h1>\n        <p class="overlay-description">\n          You can add this embed to your website by copying and pasting the HTML code below.\n        </p>\n\n        <textarea class="embed-link">'+t+'</textarea>\n        <div class="iframe-container">'+t+'</div>\n      </div>\n      <div class="overlay-close"><span class="icon icon-x"></span></div>\n    </div>\n  '}function r(){return'\n    <button class="page-option-item toggle-grid" title="Show full width charts">\n      <span class="icon icon-full-screen"></span>Show full width charts\n    </button>\n  '}function i(){return'\n    <button class="page-option-item toggle-grid" title="Show split-screen charts">\n      <span class="icon icon-split-screen"></span>Show split-screen charts\n    </button>\n  '}function s(e){return'\n    <div class="y-axis-label" style="top:'+e.top+'px">'+e.display+"</div>\n  "}function o(e){var t="",n="";return e.editable&&(t='contenteditable="true"',n='\n      <div class="chart-options">\n        <a class="option-item toggle-type" href="#" title="Switch chart type">\n          <span class="icon icon-line"></span>\n          <span class="icon icon-column"></span>\n        </a>\n\n        <a class="option-item toggle-rounding" href="#" title="Turn rounding on/off">\n          <span class="icon icon-round-off"></span>\n          <span class="icon icon-round-on"></span>\n        </a>\n      </div>\n    '),'\n    <div class="chart show-columns">\n      <div class="chart-description">\n        <h1 class="js-chartTitle title info-input" '+t+'></h1>\n        <div class="js-chartNote note info-input" '+t+'></div>\n      </div>\n\n      <div class="chart-plot-outer-container">\n        <div class="chart-plot-inner-container">\n          <div class="y-axis-container"><div class="y-axis chart-height"></div></div>\n          <div class="zero-line-container chart-height"><div class="zero-line"></div></div>\n          <div class="x-axis"><span class="x-beginning"></span><span class="x-end"></span></div>\n          <div class="selection">\n            <div class="selection-info">\n              <div class="selection-value"></div>\n              <div class="selection-xlabel"></div>\n              <div class="selection-ylabel"></div>\n            </div>\n          </div>\n          <figure class="chart-plot chart-height"></figure>\n        </div>\n      </div>\n\n      <aside class="chart-info">\n        <ul class="legend hidden"></ul>\n        '+n+"\n      </aside>\n    </div>\n  "}function u(e){return'\n    <div class="change-series-color popover">\n      <p>Change color:</p>\n      <p>\n        <span contenteditable="true" class="color-hex-input change-series-color-'+e.seriesIndex+'">\n          '+e.colorHex+'\n        </span>\n      </p>\n      <span class="arrow-bottom-left"></span>\n    </div>\n  '}function a(e){var t="",n="";return e.editable&&(t='contenteditable="true"',n='<button class="move-chart"><span class="icon icon-move"></span></button>'),'\n    <li class="legend-item">\n      <div class="legend-label info-input">\n        <span class="legend-input" '+t+">"+e.label+'</span>\n      </div>\n      <button class="legend-color">\n        <span style="background-color:'+e.color+';" class="legend-dot"></span>\n      </button>\n      '+n+"\n    </li>\n  "}function f(e){var t=e.otherCharts.map(function(e){return'\n      <a href= "#" class="move-chart-option move-to-chart-'+e.chartIndex+'">\n        '+e.title+"\n      </a>\n    "}).join("\n"),n="";return e.series.length>1&&(n='\n      <a href= "#" class="move-chart-option move-to-new-chart">\n        <span class="icon icon-plus"></span>New chart\n      </a>\n    '),'\n    <div class="move-chart-options popover">\n      <p>Move to:</p>\n      '+t+"\n      "+n+'\n      <span class="arrow-bottom-right"></span>\n    </div>\n  '}Object.defineProperty(e,"__esModule",{value:!0}),e.pageSettings=t,e.embedOverlay=n,e.gridSettingsFull=r,e.gridSettingsSplit=i,e.yAxisLabel=s,e.chart=o,e.changeSeriesColor=u,e.legendItem=a,e.moveChart=f}),define("scripts/ChartLegend",["exports","./Chart","./ChartData","./PageController","./templates"],function(e,t,n,r,i){function a(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{"default":e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=f(t),o=f(n),u=a(i),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=function(){function e(t,n,r){l(this,e),this.chart=r,this.controller=t,this.data=n,this.chartIndex=this.chart.getChartIndex(),this.$container=this.chart.getChartContainer(),this.series=this.chart.getChartSeries()}return c(e,[{key:"update",value:function(){if(this.data.getSeriesCount()===1&&this.controller.getOtherCharts(this.chartIndex).length===0){this.$container.find(".legend").html("");return}var t=$(""),n=this.data.getSerieses();for(var r=n.length-1;r>=0;r--){var i=n[r],s=this.controller.getSeriesName(this.series[r]),o=$(u.legendItem({label:s,color:this.chart.getSeriesColor(i.seriesIndex),editable:this.controller.getEditability()}));t=t.add(o),i.legendEl=o}this.$container.find(".legend").html(t).removeClass("hidden"),this.controller.getEditability()&&this.bindLegendInteractions()}},{key:"bindLegendInteractions",value:function(){var t=this;this.data.getSerieses().forEach(function(e,n){var r=e.legendEl.find(".legend-input");r.on("focusout",function(){var n=t.controller.params.seriesNames;r.text()===e.label||r.text()===""?(r.text(e.label),delete n[e.seriesIndex]):n[e.seriesIndex]=r.text(),t.controller.updateURL()}),e.legendEl.find(".legend-color").click(function(n){n.stopPropagation(),t.removePopovers(),t.openColorInput(e)}),e.legendEl.find(".move-chart").click(function(r){r.stopPropagation(),t.removePopovers(),t.openMoveChart(e,n)})}),$("html").click(function(){return t.removePopovers()})}},{key:"openColorInput",value:function(t){var n=this,r=this.chart.getSeriesColor(t.seriesIndex).replace(/^#/,"");t.legendEl.addClass("active-color-input"),t.legendEl.append(u.changeSeriesColor({colorHex:r,seriesIndex:t.seriesIndex})),this.data.getSeriesIndices().forEach(function(e){var t=n.$container.find(".change-series-color-"+e);t.on("focusout",function(){var r=n.controller.params.seriesColors,i="#"+t.text().replace(/^#/,"").trim(),s=n.chart.getDefaulSeriesColor(e),o=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(i);i===s||!o?(t.text(s),delete r[e]):r[e]=i,n.chart.render(),n.controller.updateURL()})}),this.$container.find(".change-series-color").click(function(e){return e.stopPropagation()})}},{key:"openMoveChart",value:function(t,n){var r=this,i=this.controller.getOtherCharts(this.chartIndex),s=i.length+1;i.length===0?this.controller.moveToChart(this.series[n],this.chartIndex,s):i.length===1&&this.series.length===1?this.controller.moveToChart(this.series[n],this.chartIndex,i[0].chartIndex):(t.legendEl.addClass("active"),t.legendEl.append(u.moveChart({otherCharts:i,series:this.series})),i.forEach(function(e){r.$container.find(".move-to-chart-"+e.chartIndex).click(function(t){t.preventDefault(),r.controller.moveToChart(r.series[n],r.chartIndex,e.chartIndex)})}),this.$container.find(".move-to-new-chart").click(function(){r.controller.moveToChart(r.series[n],r.chartIndex,s)}))}},{key:"removePopovers",value:function(){$("html").find(".move-chart-options, .change-series-color").remove(),$("html").find(".page-settings").removeClass("open"),$("html").find(".legend-item").removeClass("active active-color-input")}}]),e}();e.default=h}),define("scripts/Editor",["exports"],function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=function(){function e(n){var r=this;t(this,e),this.rootElement=n,this.listener=function(){},this.setContent(this.getContent()),this.rootElement.addEventListener("focusout",function(){var e=r.getContent();r.setContent(e),r.listener(e)})}return n(e,[{key:"onChange",value:function(t){this.listener=t}},{key:"getContent",value:function(){var t=this.rootElement.innerText;return t?t.trim():""}},{key:"setContent",value:function(t){if(!t){this.rootElement.innerHTML="",this.rootElement.classList.add("empty");return}var n=document.createElement("div");n.innerHTML=t;var r=n.innerText,i=(r||"").split("\n").map(function(e){return"<div>"+e+"</div>"}).join("");this.rootElement.innerHTML=i,this.rootElement.classList.remove("empty")}}]),e}();e.default=r}),define("scripts/Chart",["exports","./ChartData","./ChartLegend","../shared/utils","./PageController","./PageData","./Editor","./templates"],function(e,t,n,r,i,s,o,u){function p(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{"default":e}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=d(t),f=d(n),l=d(s),c=d(o),h=p(u),m=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=function(){function e(t,n,r,i,s){var o=this;v(this,e),this.pageController=t,this.$wrapper=r;var u={editable:t.getEditability()};this.$wrapper.html(h.chart(u)),this.$container=r.find(".chart").first(),this.$plot=this.$container.find(".chart-plot").first(),this.$xBeg=this.$container.find(".x-beginning"),this.$xEnd=this.$container.find(".x-end"),this.$selectionElem=this.$container.find(".selection"),this.$selectionXLabel=this.$container.find(".selection-xlabel"),this.$selectionYLabel=this.$container.find(".selection-ylabel"),this.$yAxis=this.$container.find(".y-axis"),this.$zeroLine=this.$container.find(".zero-line"),this.$selectionValue=this.$container.find(".selection-value"),this.$optionsElem=this.$container.find(".chart-options"),this.$pageSettings=$(".page-settings"),this.$chartDescription=this.$container.find(".chart-description"),this.titleEditor=new c.default(this.$container.find(".js-chartTitle").get(0)),this.titleEditor.onChange(function(e){if(!e){o.params.title=o.pageController.getDefaultTitle(o.chartIndex),o.titleEditor.setContent(o.params.title);return}o.params.title=e,o.pageController.updateURL()}),this.noteEditor=new c.default(this.$container.find(".js-chartNote").get(0)),this.noteEditor.onChange(function(e){o.params.note=e,o.pageController.updateURL()}),this.refresh(n,i,s),this.bindInteractions()}return m(e,[{key:"refresh",value:function(t,n,r){this.chartIndex=t,this.params=n,this.data=new a.default(r,this.params.series),this.legend=new f.default(this.pageController,this.data,this),this.setupChart(),this.render()}},{key:"setupChart",value:function(){this.$plot.empty(),this.titleEditor.setContent(this.params.title),this.noteEditor.setContent(this.params.note),this.$xBeg.html(this.data.getIndexExtent()[0]),this.$xEnd.html(this.data.getIndexExtent()[1]),this.setScales(),this.createChartElements()}},{key:"setScales",value:function(){var t=this;this.xScale=d3.scale.linear().domain([0,this.data.getIndexCount()]),this.xPosition=function(e){return Math.floor(t.xScale(e.x),0)},this.xBarWidth=function(e){var n=t.plotWidth/t.data.getIndexCount()>=8?1:0,r=e.x+1<t.data.getIndexCount()?t.xScale(e.x+1):t.plotWidth;return Math.floor(r,0)-t.xPosition(e)-n},this.xPositionLine=function(e){return t.xPosition(e)+.5*t.xBarWidth(t.data.getDatum(0,e.x))},this.yScale=d3.scale.linear(),this.yPosition=function(e){return t.yScale(e.y)},this.yPositionStacked=function(e){return t.yScale(e.y1)},this.yHeightStacked=function(e){return e.y===0?0:t.yScale(e.y0)-t.yScale(e.y1)+1},this.yRangeStacked=this.data.getStackedExtent(),this.yRangeUnstacked=this.data.getUnstackedExtent(),this.colorLight="#333333",this.colorDark="#FFFFFF",this.colorRange=["#6DCC73","#1D7775","#4FCFD5","#FCE651","#FF7050","#FFC050","#999999"]}},{key:"createChartElements",value:function(){this.svg=d3.select(this.$plot.get(0)).append("svg"),this.line=d3.svg.line().interpolate("cardinal").tension(.96).x(this.xPositionLine).y(this.yPosition),this.layerGroup=this.svg.append("g").attr("class","layers"),this.layers=this.layerGroup.selectAll("g").data(this.data.getSeriesIndices()).enter().append("g").attr("class","layer");var t=this;this.layers.each(function(e,n){var r=d3.select(this);r.append("path").attr("class","line").each(function(){t.data.getSeries(n).lineEl=this}),r.selectAll("rect").data(t.data.getValuesForSeries(n)).enter().append("rect").attr("class","column").each(function(e){t.data.getDatum(n,e.x).columnEl=this}),r.append("circle").attr("class","end-dot last-dot").attr("r",3),r.append("circle").attr("class","end-dot first-dot").attr("r",3),r.append("circle").attr("class","selected-dot").attr("r",4)})}},{key:"updateSizes",value:function(){this.margin={top:4,right:4,bottom:0,left:0},this.width=this.$plot.width(),this.plotWidth=this.width-this.margin.right-this.margin.left,this.height=this.$plot.height(),this.svg.attr("width",this.width).attr("height",this.height),this.xScale.range([this.margin.left,this.width-this.margin.right-this.margin.left]),this.yScale.range([this.height-this.margin.bottom,this.margin.top]),this.xEndEdge=this.$xEnd.offset().left-this.$plot.offset().left,this.xBegEdge=this.$xBeg.offset().left-this.$plot.offset().left+this.$xBeg.width()}},{key:"render",value:function(){this.updateSizes(),this.params.rounding==="off"?this.$container.addClass("rounding-off"):this.$container.removeClass("rounding-off"),this.selectedX=this.data.getIndexCount()-1,this.applyChartColors(),this.applyChartType(),this.updateYAxis(),this.plotAll(),this.updateSelectedX(),this.legend.update()}},{key:"getDefaulSeriesColor",value:function(t){var n=this.data.getSeriesIndices();if(n.length===1)return this.pageController.params.isLight()?this.colorLight:this.colorDark;var r=n.indexOf(t),i=this.colorRange.length,s=r%i;return this.colorRange[s]}},{key:"getSeriesColor",value:function(t){return this.pageController.params.getSeriesColor(t)||this.getDefaulSeriesColor(t)}},{key:"applyChartColors",value:function(){var t=this;this.layers.each(function(e){var n=d3.select(this);n.selectAll(".line").attr("stroke",t.getSeriesColor(e)),n.selectAll(".column, .selected-column, .selected-dot, .end-dot").attr("fill",t.getSeriesColor(e))})}},{key:"applyChartType",value:function(){if(this.params.type==="column")this.$container.addClass("show-columns"),this.yRange=this.yRangeStacked,this.focusedSeriesIndex=this.data.getSeriesCount();else{this.$container.removeClass("show-columns"),this.yRange=this.yRangeUnstacked;var t=this.data.getUnstackedValuesAtIndex(this.selectedX);this.focusedSeriesIndex=t.indexOf(d3.max(t))}var n=function(t){var n=t[0]<0?t[0]*1.1:0;return[n,Math.max(0,t[1])]};this.yScale.domain(n(this.yRange))}},{key:"plotAll",value:function(){var t=this;this.layers.each(function(e,n){var r=d3.select(this);r.selectAll(".column").attr("x",t.xPosition).attr("y",t.yPositionStacked).attr("height",t.yHeightStacked).attr("width",t.xBarWidth),r.selectAll(".line").attr("d",t.line(t.data.getValuesForSeries(n)));var i=t.data.getFirstDatum(n),s=t.data.getLastDatum(n);r.selectAll(".last-dot").attr("cx",t.xPositionLine(s)).attr("cy",t.yPosition(s)),r.selectAll(".first-dot").attr("cx",t.xPositionLine(i)).attr("cy",t.yPosition(i))})}},{key:"updateYAxis",value:function(){var t=this,n="",i=(0,r.getNiceIntervals)(this.yRange,this.height),s=this.$yAxis.height()-this.$container.height()+60;i.forEach(function(e){e.top=t.yScale(e.value),e.top>=s&&(e.display=t.params.rounding==="on"?e.displayString:e.rawString,n+=h.yAxisLabel(e))}),this.$yAxis.html(n),this.$zeroLine.removeClass("hidden").css("top",this.yScale(0))}},{key:"updateSelectedX",value:function(t){t!=undefined&&(this.selectedX=t);var n=this.xPosition(this.data.getDatum(0,this.selectedX)),r=.5*this.xBarWidth(this.data.getDatum(0,this.selectedX)),i=n+r;this.$selectionElem.css("left",i);var s=i,o=i+this.$selectionXLabel.width();i<this.width/2?this.$selectionElem.addClass("on-right"):(this.$selectionElem.removeClass("on-right"),s=i-this.$selectionXLabel.width(),o=i),s<=this.xBegEdge?this.$xBeg.addClass("hidden"):this.$xBeg.removeClass("hidden"),o>=this.xEndEdge?this.$xEnd.addClass("hidden"):this.$xEnd.removeClass("hidden");var u=this;this.layers.each(function(e,t){var n=u.data.getSeriesExtent(t);u.selectedX>=n[0]&&u.selectedX<=n[1]?d3.select(this).selectAll(".selected-dot").attr("cx",u.xPositionLine(u.data.getDatum(t,u.selectedX))).attr("cy",u.yPosition(u.data.getDatum(t,u.selectedX))).style({opacity:"1"}):d3.select(this).selectAll(".selected-dot").style({opacity:"0"})});var a=this.data.getIndexCount();for(var f=0;f<a;f++){var l="column";u.selectedX===f&&(l="column selected");for(var c=0;c<u.data.getSeriesCount();c++){var h=u.data.getDatum(c,f).columnEl;h&&d3.select(h).attr("class",l)}}this.updateSelectionText()}},{key:"updateSelectionText",value:function(){var t=this.focusedSeriesIndex>=this.data.getSeriesCount(),n=t?this.data.getSeriesCount()-1:this.focusedSeriesIndex,i=this.data.getDatum(n,this.selectedX),s="",o=this.pageController.params.isLight()?this.colorLight:this.colorDark;t||i.ySeries!=null&&(o=this.getSeriesColor(this.data.getSeries(i.ySeries).seriesIndex));if(this.data.getSeriesCount()>1){var u=this.getChartSeries()[n];s=t?"total":this.pageController.getSeriesName(u)}var a=this.data.getStackedExtentForIndex(this.selectedX),f=a[1]+a[0],l=t?f:(0,r.stringToNumber)(i.yRaw),c=this.params.rounding==="on"?(0,r.getRoundedValue)(l,this.yRange):l;this.$selectionYLabel.text(s).css("color",o),this.$selectionXLabel.text(i.xLabel),this.$selectionValue.text(c).css("color",o)}},{key:"bindInteractions",value:function(){var t=this;Object.keys(i.OPTIONS).forEach(function(e){t.$container.find(".toggle-"+e).click(function(n){n.preventDefault();var r=i.OPTIONS[e];t.params[e]=t.params[e]===r[0]?r[1]:r[0],t.render(),t.pageController.updateURL()})}),this.$container.mousemove(function(e){return t.handleMouseover(e)})}},{key:"handleMouseover",value:function(t){var n=this;this.$container.addClass("active"),$("body").addClass("page-active"),this.mouseTimer&&(clearTimeout(this.mouseTimer),this.mouseTimer=null),this.mouseTimer=setTimeout(function(){if(n.$optionsElem.length&&n.$optionsElem.is(":hover"))return;if(n.$chartDescription.length&&n.$chartDescription.is(":hover"))return;if(n.$pageSettings.length&&n.$pageSettings.is(":hover"))return;n.$container.removeClass("active"),$("body").removeClass("page-active"),n.$pageSettings.removeClass("open")},1e3);if(t.pageY-this.$plot.offset().top>this.$plot.height())return;var r=this.getClosestPoint(t);if(r.selectedX!==this.selectedX||r.focusedSeriesIndex!==this.focusedSeriesIndex)this.selectedX=r.selectedX,this.focusedSeriesIndex=r.focusedSeriesIndex,this.updatefocusedSeriesIndex(),this.pageController.updateSelectedX(this.selectedX)}},{key:"getClosestPoint",value:function(t){var n=this,r=(t.pageX-this.$plot.offset().left)*this.data.getIndexCount()/(this.width-this.margin.right),i=t.pageY-this.$plot.offset().top,s=Math.min(Math.floor(Math.max(r,0)),this.data.getIndexCount()-1),o=this.focusedSeriesIndex,u=d3.range(this.data.getSeriesCount()).map(function(e){var t=n.data.getDatum(e,s),r=n.params.type==="line"?n.yPosition(t):n.yPositionStacked(t),o=n.params.type==="line"?Math.abs(i-r):i-r,u=n.params.type==="line"||o>0;return{diff:o,series:e,isValid:u}});u=u.filter(function(e){return e.isValid}),u.sort(function(e,t){return d3.ascending(e.diff,t.diff)}),o=u.length?u[0].series:0;if(this.params.type==="column"){var a=this.data.getStackedExtentForIndex(s),f=[this.yScale(a[0]),this.yScale(a[1])];if(i<=f[1]||i>f[0])o=this.data.getSeriesCount()}return{selectedX:s,focusedSeriesIndex:o}}},{key:"updatefocusedSeriesIndex",value:function(){if(this.params.type==="line"){this.$container.find(".line").attr("class","line");var t=d3.select(this.data.getSeries(this.focusedSeriesIndex).lineEl);t.attr("class","line focused"),d3.select(t.node().parentNode).each(function(){this.parentNode.appendChild(this)})}}},{key:"getChartIndex",value:function(){return this.chartIndex}},{key:"getChartContainer",value:function(){return this.$container}},{key:"getChartSeries",value:function(){return this.params.series}}]),e}();e.default=g}),define("scripts/ChartParameters",["exports","../shared/utils","../shared/sha1"],function(e,t,n){function s(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=o(t),i=s(n),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f="dark",l="light",c="full",h="split",p={type:["column","line"],rounding:["on","off"]},d=function(){function e(t){u(this,e),this.url=t,this.charts=[{}],this.seriesColors={},this.seriesNames={},this._color=l,this._grid=h,this._getDefaultTitle=function(e){return""}}return a(e,[{key:"withDefaultTitle",value:function(t){return this._getDefaultTitle=t,this}},{key:"isLight",value:function(){return this._color==l}},{key:"toggleColor",value:function(){this._color=this.isLight()?f:l}},{key:"isFull",value:function(){return this._grid==c}},{key:"toggleGrid",value:function(){this._grid=this.isFull()?h:c}},{key:"getSeriesColor",value:function(t){return this.seriesColors[t]}},{key:"getSeriesName",value:function(t){return this.seriesNames[t]}},{key:"compress",value:function(){var t=this,n={dataUrl:this.url};return Object.keys(this.seriesNames).length&&(n.seriesNames=this.seriesNames),Object.keys(this.seriesColors).length&&(n.seriesColors=this.seriesColors),this.isLight()||(n.color=this._color),this.isFull()&&(n.grid=this._grid),n.charts=this.charts.map(function(e,n){var r={};return Object.keys(p).forEach(function(t){e[t]&&e[t]!==p[t][0]&&(r[t]=e[t])}),e.title&&e.title!==t._getDefaultTitle(n)&&(r.title=e.title),e.note&&(r.note=e.note),n>0&&e.series&&(r.series=e.series),r}),n.charts.length===1&&!Object.keys(n.charts[0]).length&&delete n.charts,n}}],[{key:"fromJSON",value:function(n){var r=new e(n.dataUrl);return n.charts&&(r.charts=n.charts),n.seriesNames&&(r.seriesNames=n.seriesNames),n.seriesColors&&(r.seriesColors=n.seriesColors),n.grid&&(r._grid=n.grid),n.color&&(r._color=n.color),r}},{key:"fromQueryString",value:function(n){var i=r.parseQueryString(n),s=i.data;if(!s)return null;var o=s.csvUrl||s.dataUrl;if(!o)return null;var u=new e(o);return s.charts&&(u.charts=s.charts),s.seriesNames&&(u.seriesNames=s.seriesNames),s.seriesColors&&(u.seriesColors=s.seriesColors),s.grid&&(u._grid=s.grid),s.color&&(u._color=s.color),u}}]),e}();e.default=d}),define("scripts/PageController",["exports","./PageData","./Chart","./ChartParameters","./templates","../shared/utils"],function(e,t,n,r,i,s){function c(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function h(e){return e&&e.__esModule?e:{"default":e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.PageController=e.OPTIONS=undefined;var o=h(t),u=h(n),a=h(r),f=c(i),l=c(s),d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),v=18e5,m=e.OPTIONS={type:["column","line"],rounding:["on","off"]},g=e.PageController=function(){function e(){var t=this;p(this,e),this.isEmbed=!1,this.chartObjects=[],this.$body=$("body"),this.$charts=$(".charts"),$(window).resize(function(){clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){return t.setDimensions()},30)}),$(document).keyup(function(e){e.keyCode==27&&($(".overlay-container").remove(),$(".page-settings").removeClass("open"))}),$(".load-data-form").submit(function(e){e.preventDefault();var n=$(".data-file-input").val();if(!n){var r="You’ll need to paste in the URL to a .csv file or Google Spreadsheet first.";t.errorNotify(new Error(r));return}t.fetchPageData(n,null,null)})}return d(e,[{key:"activate",value:function(){var t=this,n=/\/(c|embed)\/([a-z\d]{7})\/?$/.exec(window.location.pathname),r=n&&n[2],i=a.default.fromQueryString(window.location.search||"");if(!r&&!i){this.clearExisting(),this.$body.addClass("pre-load");return}this.isEmbed=n&&n[1]=="embed",this.isEmbed||setInterval(function(){return t.fetchPageData()},v);if(r){this.fetchPageData(null,r,null);return}i&&function(){t.params=i.withDefaultTitle(function(e){return t.getDefaultTitle(e)});var e=t.params.compress(),n=e.dataUrl||null;t.updateURL(!1,function(){return t.fetchPageData(n,null,e)})}()}},{key:"fetchPageData",value:function(t,n,r){var i=this;if(!t&&!n){if(!this.params)return;n=l.getChartId(this.params.compress())}this.$body.addClass("loading"),this.updatePageTitle("Charted (...)"),this.clearExisting(),t&&$(".data-file-input").val(t);var s="/load/?url="+encodeURIComponent(t||"")+"&id="+encodeURIComponent(n||"");d3.json(s,function(e,t){if(e){i.errorNotify(e);return}if(!t.data||!t.data.length){i.errorNotify(new Error("Missing data from source: "+t.params.dataUrl));return}var n=r?r:t.params;n.dataUrl=t.params.dataUrl,i.params=a.default.fromJSON(n).withDefaultTitle(function(e){return i.getDefaultTitle(e)}),i.data=new o.default.fromJSON(i.params.url,t.data),i.render()})}},{key:"render",value:function(){var t=this,n=this.params.isLight()?"light":"dark";this.$body.addClass(n),this.applyEmbed(),this.setupPageSettings(),this.params.charts[0].title||(this.params.charts[0].title=this.data.serieses.length>1?"Chart":this.data.serieses[0].label),this.$body.removeClass("pre-load loading error"),this.params.charts.forEach(function(e,n){return t.updateChart(n)}),this.setDimensions(),this.updateURL(),$(".data-source-url").val(this.params.url)}},{key:"clearExisting",value:function(){$(".chart-wrapper, .page-settings").remove(),this.chartObjects=[],$("body, .settings, .settings-popover, .toggle-color").unbind()}},{key:"setupPageSettings",value:function(){var t=this;if(this.isEmbed)return;this.$body.append(f.pageSettings());var n=this.$body.find(".page-settings");$(".download-data").attr("href",this.params.url),$(".data-source-url").val(this.params.url),n.find(".settings").click(function(e){e.stopPropagation(),n.addClass("open")}),n.find(".settings-popover").click(function(e){return e.stopPropagation()}),this.$body.click(function(){return n.removeClass("open")}),n.find(".toggle-color").click(function(){return t.toggleColor()}),n.find(".get-embed").click(function(){return t.getEmbed()}),n.find(".update-data-source").click(function(){return t.fetchPageData($(".data-source-url").val(),null,t.params)})}},{key:"updateChart",value:function(t){var n=this.getFullParams(t);n.series.length===0?this.removeChart(t):t<=this.chartObjects.length-1?this.chartObjects[t].refresh(t,n,this.data):this.createNewChart(t,this.getFullParams(t))}},{key:"getFirstChartSeries",value:function(){var t=[],n=[];for(var r=1;r<this.params.charts.length;r++)t=t.concat(this.params.charts[r].series);for(var i=0;i<this.data.serieses.length;i++){if(t.indexOf(i)>-1)continue;n.push(i)}return n}},{key:"createNewChart",value:function(t,n){var r=$('<div class="chart-wrapper"></div>'),i=this.getChartDimensions();r.outerHeight(i.height).outerWidth(i.width),this.$charts.append(r),this.chartObjects.push(new u.default(this,t,r,n,this.data))}},{key:"moveToChart",value:function(t,n,r){var i=this,s=this.params.charts[n],o=this.params.charts[r];this.params.charts.forEach(function(e,t){e.title&&e.title==i.getDefaultTitle(t)&&delete e.title}),r>this.params.charts.length-1?this.params.charts.push({series:[t]}):r>0&&(o.series.push(t),o.series.sort(function(e,t){return e-t})),n>0&&(s.series=s.series.filter(function(e){return e!==t})),this.updateChart(r),$("html, body").animate({scrollTop:this.chartObjects[r].$wrapper.offset().top},300),this.updateChart(n);for(var u=n;u<this.chartObjects.length;u++){if(u===r)continue;this.updateChart(u)}this.setDimensions(),this.updateURL()}},{key:"removeChart",value:function(t){for(var n=t+1;n<this.chartObjects.length;n++)this.chartObjects[n].chartIndex--;this.params.charts.splice(t,1),this.chartObjects[t].$wrapper.remove(),this.chartObjects.splice(t,1)}},{key:"getFullParams",value:function(t){var n=this.params.charts[t];return Object.keys(m).forEach(function(e){n[e]=n[e]||m[e][0]}),t===0&&(n.series=this.getFirstChartSeries()),n.title=n.title||this.getDefaultTitle(t),n}},{key:"getDefaultTitle",value:function(t){var n=this.params.charts[t].series;if(!n||!this.data)return"Charted";if(n.length===1)return this.getSeriesName(n[0]);var r=this.params.charts.filter(function(e,n){return e.series.length>0&&n<t});return t===0?"Chart":"Chart "+(1+r.length)}},{key:"getSeriesName",value:function(t){return this.params.getSeriesName(t)||this.data.serieses[t].label}},{key:"getChartCount",value:function(){return this.params.charts.length}},{key:"getOtherCharts",value:function(t){var n=this;return this.params.charts.map(function(e,t){return{title:e.title||n.getDefaultTitle(t),chartIndex:t}}).filter(function(e,n){return n!==t})}},{key:"updateSelectedX",value:function(t){this.chartObjects.forEach(function(e){e.updateSelectedX(t)})}},{key:"toggleColor",value:function(){this.params.toggleColor(),this.$body.toggleClass("dark"),this.chartObjects.forEach(function(e){e.render()}),this.updateURL()}},{key:"toggleGrid",value:function(){this.params.toggleGrid(),this.applyGrid(),this.setDimensions(),this.updateURL()}},{key:"applyGrid",value:function(){var t=this;this.$body.toggleClass("full");var n=f.gridSettingsFull;this.params&&this.params.isFull()&&(n=f.gridSettingsSplit);var r=this.chartObjects?this.chartObjects.length:0;$(".grid-option").html(r>1?n():""),$(".toggle-grid").click(function(){return t.toggleGrid()})}},{key:"getEmbed",value:function(){var t=this.params.compress(),n=l.getChartId(t);this.$body.append(f.embedOverlay(n)),this.$body.find(".overlay-content").click(function(e){return e.stopPropagation()}),this.$body.click(function(){return $(".overlay-container").remove()})}},{key:"applyEmbed",value:function(){this.params.embed?this.$body.addClass("embed"):this.$body.removeClass("embed")}},{key:"getEditability",value:function(){return!this.isEmbed}},{key:"getChartDimensions",value:function(){var t=600,n=1200,r=800,i=$(window).innerWidth(),s="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,o=i>r?s:"auto",u=this.chartObjects?this.chartObjects.length:0,a=u>=2&&i>n&&!this.params.isFull(),f=s>t&&i>r,l=u>=3||u===2&&!a,c=f&&l;return{width:a?i/2:i,height:c?s/2:o,isHalfHeight:c,isGrid:a}}},{key:"setDimensions",value:function(){var t=this.getChartDimensions();t.isGrid?(this.$body.addClass("chart-grid"),this.$body.removeClass("half-height")):t.isHalfHeight?(this.$body.removeClass("chart-grid"),this.$body.addClass("half-height")):this.$body.removeClass("chart-grid half-height"),$(".chart-wrapper").outerHeight(t.height).outerWidth(t.width);var n=Math.floor((this.chartObjects.length-1)/2)*2;this.chartObjects.forEach(function(e,r){t.isGrid&&r>=n?e.$wrapper.addClass("bottom-row"):e.$wrapper.removeClass("bottom-row"),e.render()}),this.applyGrid(),this.maybeBroadcastDimensions()}},{key:"maybeBroadcastDimensions",value:function(){if(!this.isEmbed)return;var t=window.location.toString().replace("/c/","/embed/"),n=document.body.scrollHeight;n=n>600&&document.body.offsetWidth>=800?600:n;var r={chartId:l.getChartId(this.params.compress()),src:t,context:"iframe.resize",height:n};window.parent&&window.parent.postMessage(JSON.stringify(r),"*")}},{key:"errorNotify",value:function(t){this.$body.addClass("error").removeClass("loading"),this.updatePageTitle();var n=t.message||t.responseText||"There’s been an error. Please check that you are using a valid .csv file. If you are using a Google Spreadsheet or Dropbox link, the privacy setting must be set to shareable.";$(".error-message").html(n)}},{key:"updateURL",value:function(){var t=arguments.length<=0||arguments[0]===undefined?!1:arguments[0],n=arguments[1];this.updatePageTitle();var r=this.params.compress(),i=l.getChartId(r),s="/c/"+i;window.history.pushState({},null,s),t||d3.xhr(s).header("Content-Type","application/json").post(JSON.stringify(r),function(){n&&n()})}},{key:"updatePageTitle",value:function(t){var n=this,r="Charted",i=[];this.params&&this.params.charts&&(i=this.params.charts),t?r=t:i.length>0&&(r=i.map(function(e,t){return e.title||n.getDefaultTitle(t)}).join(", "),r==="Chart"&&(r+=" of "+i[0].series.map(function(e){return n.getSeriesName(e)}).join(", "))),document.title=r}}]),e}()}),define("scripts/charted",["./PageController"],function(e){$(function(){var t=new e.PageController;t.activate()})});