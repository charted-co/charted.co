/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.22 Copyright (c) 2010-2015, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/**
   * SHA-1 implementation.
   *
   * Adopted from SHA-1 implementation in JavaScript by Chris Veness.
   * (c) Chris Veness 2002-2014 / MIT Licence
   *
   * See:
   *  http://csrc.nist.gov/groups/ST/toolkit/secure_hashing.html
   *  http://csrc.nist.gov/groups/ST/toolkit/examples.html
   */

var requirejs,require,define;!function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,i){return t&&eachProp(t,function(t,r){!n&&hasProp(e,r)||(!i||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,n,i)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,i){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=i,n&&(r.originalError=n),r}function newContext(e){function t(e){var t,n;for(t=0;t<e.length;t++)if(n=e[t],"."===n)e.splice(t,1),t-=1;else if(".."===n){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function n(e,n,i){var r,a,s,o,l,c,u,d,h,f,p,g,m=n&&n.split("/"),v=k.map,y=v&&v["*"];if(e&&(e=e.split("/"),u=e.length-1,k.nodeIdCompat&&jsSuffixRegExp.test(e[u])&&(e[u]=e[u].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&m&&(g=m.slice(0,m.length-1),e=g.concat(e)),t(e),e=e.join("/")),i&&v&&(m||y)){s=e.split("/");e:for(o=s.length;o>0;o-=1){if(c=s.slice(0,o).join("/"),m)for(l=m.length;l>0;l-=1)if(a=getOwn(v,m.slice(0,l).join("/")),a&&(a=getOwn(a,c))){d=a,h=o;break e}!f&&y&&getOwn(y,c)&&(f=getOwn(y,c),p=o)}!d&&f&&(d=f,h=p),d&&(s.splice(0,h,d),e=s.join("/"))}return r=getOwn(k.pkgs,e),r?r:e}function i(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===x.contextName)return t.parentNode.removeChild(t),!0})}function r(e){var t=getOwn(k.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),x.require.undef(e),x.makeRequire(null,{skipMap:!0})([e]),!0}function a(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function s(e,t,i,r){var s,o,l,c,u=null,d=t?t.name:null,h=e,f=!0,p="";return e||(f=!1,e="_@r"+(P+=1)),c=a(e),u=c[0],e=c[1],u&&(u=n(u,d,r),o=getOwn(O,u)),e&&(u?p=o&&o.normalize?o.normalize(e,function(e){return n(e,d,r)}):e.indexOf("!")===-1?n(e,d,r):e:(p=n(e,d,r),c=a(p),u=c[0],p=c[1],i=!0,s=x.nameToUrl(p))),l=!u||o||i?"":"_unnormalized"+(I+=1),{prefix:u,name:p,parentMap:t,unnormalized:!!l,url:s,originalName:h,isDefine:f,id:(u?u+"!"+p:p)+l}}function o(e){var t=e.id,n=getOwn(E,t);return n||(n=E[t]=new x.Module(e)),n}function l(e,t,n){var i=e.id,r=getOwn(E,i);!hasProp(O,i)||r&&!r.defineEmitComplete?(r=o(e),r.error&&"error"===t?n(r.error):r.on(t,n)):"defined"===t&&n(O[i])}function c(e,t){var n=e.requireModules,i=!1;t?t(e):(each(n,function(t){var n=getOwn(E,t);n&&(n.error=e,n.events.error&&(i=!0,n.emit("error",e)))}),i||req.onError(e))}function u(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(x.defQueueMap[t]=!0),M.push(e)}),globalDefQueue=[])}function d(e){delete E[e],delete w[e]}function h(e,t,n){var i=e.map.id;e.error?e.emit("error",e.error):(t[i]=!0,each(e.depMaps,function(i,r){var a=i.id,s=getOwn(E,a);!s||e.depMatched[r]||n[a]||(getOwn(t,a)?(e.defineDep(r,O[a]),e.check()):h(s,t,n))}),n[i]=!0)}function f(){var e,t,n=1e3*k.waitSeconds,a=n&&x.startTime+n<(new Date).getTime(),s=[],o=[],l=!1,u=!0;if(!y){if(y=!0,eachProp(w,function(e){var n=e.map,c=n.id;if(e.enabled&&(n.isDefine||o.push(e),!e.error))if(!e.inited&&a)r(c)?(t=!0,l=!0):(s.push(c),i(c));else if(!e.inited&&e.fetched&&n.isDefine&&(l=!0,!n.prefix))return u=!1}),a&&s.length)return e=makeError("timeout","Load timeout for modules: "+s,null,s),e.contextName=x.contextName,c(e);u&&each(o,function(e){h(e,{},{})}),a&&!t||!l||!isBrowser&&!isWebWorker||S||(S=setTimeout(function(){S=0,f()},50)),y=!1}}function p(e){hasProp(O,e[0])||o(s(e[0],null,!0)).init(e[1],e[2])}function g(e,t,n,i){e.detachEvent&&!isOpera?i&&e.detachEvent(i,t):e.removeEventListener(n,t,!1)}function m(e){var t=e.currentTarget||e.srcElement;return g(t,x.onScriptLoad,"load","onreadystatechange"),g(t,x.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function v(){var e;for(u();M.length;){if(e=M.shift(),null===e[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));p(e)}x.defQueueMap={}}var y,b,x,C,S,k={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},E={},w={},j={},M=[],O={},T={},L={},P=1,I=1;return C={require:function(e){return e.require?e.require:e.require=x.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?O[e.map.id]=e.exports:e.exports=O[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(k.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},b=function(e){this.events=getOwn(j,e.id)||{},this.map=e,this.shim=getOwn(k.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,n,i){i=i||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,x.startTime=(new Date).getTime();var e=this.map;return this.shim?void x.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;T[e]||(T[e]=!0,x.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id,i=this.depExports,r=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){try{r=x.execCb(n,a,i,r)}catch(t){e=t}if(this.map.isDefine&&void 0===r&&(t=this.module,t?r=t.exports:this.usingExports&&(r=this.exports)),e){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",c(this.error=e);"undefined"!=typeof console&&console.error?console.error(e):req.onError(e)}}else r=a;if(this.exports=r,this.map.isDefine&&!this.ignore&&(O[n]=r,req.onResourceLoad)){var s=[];each(this.depMaps,function(e){s.push(e.normalizedMap||e)}),req.onResourceLoad(x,this.map,s)}d(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(x.defQueueMap,n)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,i=s(e.prefix);this.depMaps.push(i),l(i,"defined",bind(this,function(i){var r,a,u,h=getOwn(L,this.map.id),f=this.map.name,p=this.map.parentMap?this.map.parentMap.name:null,g=x.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(i.normalize&&(f=i.normalize(f,function(e){return n(e,p,!0)})||""),a=s(e.prefix+"!"+f,this.map.parentMap),l(a,"defined",bind(this,function(e){this.map.normalizedMap=a,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),u=getOwn(E,a.id),void(u&&(this.depMaps.push(a),this.events.error&&u.on("error",bind(this,function(e){this.emit("error",e)})),u.enable()))):h?(this.map.url=x.nameToUrl(h),void this.load()):(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),r.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(E,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&d(e.map.id)}),c(e)}),r.fromText=bind(this,function(n,i){var a=e.name,l=s(a),u=useInteractive;i&&(n=i),u&&(useInteractive=!1),o(l),hasProp(k.config,t)&&(k.config[a]=k.config[t]);try{req.exec(n)}catch(e){return c(makeError("fromtexteval","fromText eval for "+t+" failed: "+e,e,[t]))}u&&(useInteractive=!0),this.depMaps.push(l),x.completeLoad(a),g([a],r)}),void i.load(e.name,g,r,k))})),x.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){w[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,i,r;if("string"==typeof e){if(e=s(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(C,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,l(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?l(e,"error",bind(this,this.errback)):this.events.error&&l(e,"error",bind(this,function(e){this.emit("error",e)}))}n=e.id,i=E[n],hasProp(C,n)||!i||i.enabled||x.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(E,e.id);t&&!t.enabled&&x.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},x={config:k,contextName:e,registry:E,defined:O,urlFetched:T,defQueue:M,defQueueMap:{},Module:b,makeModuleMap:s,nextTick:req.nextTick,onError:c,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=k.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){n[t]?(k[t]||(k[t]={}),mixin(k[t],e,!0,!0)):k[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(L[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,n){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=x.makeShimExports(e)),t[n]=e}),k.shim=t),e.packages&&each(e.packages,function(e){var t,n;e="string"==typeof e?{name:e}:e,n=e.name,t=e.location,t&&(k.paths[n]=e.location),k.pkgs[n]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(E,function(e,t){e.inited||e.map.unnormalized||(e.map=s(t,null,!0))}),(e.deps||e.callback)&&x.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,r){function a(n,i,l){var u,d,h;return r.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof n?isFunction(i)?c(makeError("requireargs","Invalid require call"),l):t&&hasProp(C,n)?C[n](E[t.id]):req.get?req.get(x,n,t,a):(d=s(n,t,!1,!0),u=d.id,hasProp(O,u)?O[u]:c(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(v(),x.nextTick(function(){v(),h=o(s(null,t)),h.skipMap=r.skipMap,h.init(n,i,l,{enabled:!0}),f()}),a)}return r=r||{},mixin(a,{isBrowser:isBrowser,toUrl:function(e){var i,r=e.lastIndexOf("."),a=e.split("/")[0],s="."===a||".."===a;return r!==-1&&(!s||r>1)&&(i=e.substring(r,e.length),e=e.substring(0,r)),x.nameToUrl(n(e,t&&t.id,!0),i,!0)},defined:function(e){return hasProp(O,s(e,t,!1,!0).id)},specified:function(e){return e=s(e,t,!1,!0).id,hasProp(O,e)||hasProp(E,e)}}),t||(a.undef=function(e){u();var n=s(e,t,!0),r=getOwn(E,e);r.undefed=!0,i(e),delete O[e],delete T[n.url],delete j[e],eachReverse(M,function(t,n){t[0]===e&&M.splice(n,1)}),delete x.defQueueMap[e],r&&(r.events.defined&&(j[e]=r.events),d(e))}),a},enable:function(e){var t=getOwn(E,e.id);t&&o(e).enable()},completeLoad:function(e){var t,n,i,a=getOwn(k.shim,e)||{},s=a.exports;for(u();M.length;){if(n=M.shift(),null===n[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);p(n)}if(x.defQueueMap={},i=getOwn(E,e),!t&&!hasProp(O,e)&&i&&!i.inited){if(!(!k.enforceDefine||s&&getGlobal(s)))return r(e)?void 0:c(makeError("nodefine","No define call for "+e,null,[e]));p([e,a.deps||[],a.exportsFn])}f()},nameToUrl:function(e,t,n){var i,r,a,s,o,l,c,u=getOwn(k.pkgs,e);if(u&&(e=u),c=getOwn(L,e))return x.nameToUrl(c,t,n);if(req.jsExtRegExp.test(e))o=e+(t||"");else{for(i=k.paths,r=e.split("/"),a=r.length;a>0;a-=1)if(s=r.slice(0,a).join("/"),l=getOwn(i,s)){isArray(l)&&(l=l[0]),r.splice(0,a,l);break}o=r.join("/"),o+=t||(/^data\:|\?/.test(o)||n?"":".js"),o=("/"===o.charAt(0)||o.match(/^[\w\+\.\-]+:/)?"":k.baseUrl)+o}return k.urlArgs?o+((o.indexOf("?")===-1?"?":"&")+k.urlArgs):o},load:function(e,t){req.load(x,e,t)},execCb:function(e,t,n,i){return t.apply(i,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=m(e);x.completeLoad(t.id)}},onScriptError:function(e){var t=m(e);if(!r(t.id)){var n=[];return eachProp(E,function(e,i){0!==i.indexOf("_@r")&&each(e.depMaps,function(e){return e.id===t.id&&n.push(i),!0})}),c(makeError("scripterror",'Script error for "'+t.id+(n.length?'", needed by: '+n.join(", "):'"'),e,[t.id]))}}},x.require=x.makeRequire(),x}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,n,i){var r,a,s=defContextName;return isArray(e)||"string"==typeof e||(a=e,isArray(t)?(e=t,t=n,n=i):e=[]),a&&a.context&&(s=a.context),r=getOwn(contexts,s),r||(r=contexts[s]=req.s.newContext(s)),a&&r.configure(a),r.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var i=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return i.type=e.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i},req.load=function(e,t,n){var i,r=e&&e.config||{};if(isBrowser)return i=req.createNode(r,t,n),r.onNodeCreated&&r.onNodeCreated(i,r,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),!i.attachEvent||i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0||isOpera?(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{importScripts(n),e.completeLoad(t)}catch(i){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,i,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var i,r;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript(),i&&(e||(e=i.getAttribute("data-requiremodule")),r=contexts[i.getAttribute("data-requirecontext")])),r?(r.defQueue.push([e,t,n]),r.defQueueMap[e]=!0):globalDefQueue.push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),define("scripts/Actions",["exports"],function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function e(n){t(this,e),this.rootElement=n,this.listeners={}}return n(e,[{key:"activate",value:function(){this.boundListener=this.handleClick.bind(this),this.rootElement.addEventListener("click",this.boundListener)}},{key:"deactivate",value:function(){this.boundListener&&this.rootElement.removeEventListener("click",this.boundListener),delete this.boundListener,delete this.rootElement,this.listeners={}}},{key:"add",value:function(e,t,n){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t.bind(n)),this}},{key:"handleClick",value:function(e){var t=e.target;if(t instanceof Element&&!(t instanceof HTMLElement&&"BUTTON"==t.nodeName&&"submit"==t.getAttribute("type")))for(var n=this.rootElement.parentNode;t&&t!=n&&t!=document;){if(t instanceof HTMLElement){var i=t.getAttribute("data-click");if(this.isClickable(t)&&!i)return;if(i)return void this.fire(i,t,e)}t=t.parentNode}}},{key:"isClickable",value:function(e){switch(e.nodeName){case"BUTTON":case"LINK":case"INPUT":case"TEXTAREA":return!0;default:if(e.getAttribute("contenteditable"))return!0}return!1}},{key:"fire",value:function(e,t,n){this.listeners[e]&&(this.listeners[e].forEach(function(i){i(t,e,n)}),n.stopPropagation(),n.preventDefault())}}]),e}();e.default=i}),define("shared/sha1",["exports"],function(e){function t(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=a(e);var s=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);for(var o=e.length/4+2,l=Math.ceil(o/16),c=new Array(l),u=0;u<l;u++){c[u]=new Array(16);for(var d=0;d<16;d++)c[u][d]=e.charCodeAt(64*u+4*d)<<24|e.charCodeAt(64*u+4*d+1)<<16|e.charCodeAt(64*u+4*d+2)<<8|e.charCodeAt(64*u+4*d+3)}c[l-1][14]=8*(e.length-1)/Math.pow(2,32),c[l-1][14]=Math.floor(c[l-1][14]),c[l-1][15]=8*(e.length-1)&4294967295;for(var h,f,p,g,m,v=1732584193,y=4023233417,b=2562383102,x=271733878,C=3285377520,S=new Array(80),u=0;u<l;u++){for(var k=0;k<16;k++)S[k]=c[u][k];for(var k=16;k<80;k++)S[k]=i(S[k-3]^S[k-8]^S[k-14]^S[k-16],1);h=v,f=y,p=b,g=x,m=C;for(var k=0;k<80;k++){var E=Math.floor(k/20),w=i(h,5)+n(E,f,p,g)+m+s[E]+S[k]&4294967295;m=g,g=p,p=i(f,30),f=h,h=w}v=v+h&4294967295,y=y+f&4294967295,b=b+p&4294967295,x=x+g&4294967295,C=C+m&4294967295}var j=r(v)+r(y)+r(b)+r(x)+r(C);return t?j.slice(0,7):j}function n(e,t,n,i){switch(e){case 0:return t&n^~t&i;case 1:return t^n^i;case 2:return t&n^t&i^n&i;case 3:return t^n^i}}function i(e,t){return e<<t|e>>>32-t}function r(e){for(var t,n="",i=7;i>=0;i--)t=e>>>4*i&15,n+=t.toString(16);return n}function a(e){return unescape(encodeURIComponent(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=t}),define("shared/utils",["exports","./sha1"],function(e,t){function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(0,g.default)(JSON.stringify(e),!0)}function r(e){var t=/\/(?:c|embed)\/(\w+)(?:|\?.*)?/.exec(e);return t?t[1]:null}function a(e){return Math.floor(Math.log(e)/Math.LN10,0)}function s(e){var t=e.slice(1);if(!t)return{};var n=t.split("&"),i={};return n.forEach(function(e){var t=e.split("=");1===t.length?i.data=JSON.parse(decodeURIComponent(t[0])):i[t[0]]=t[1]}),i}function o(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function l(e){return Number(String(e).replace(/[^0-9\.\-]/g,"")||0)}function c(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function u(e,t){var n=2,i=3,r=a(Math.abs(t[1])),s=a(Math.abs(t[0])),o=Math.abs(r-s),l=Math.max(r,s),c=o<=n?l:a(Math.abs(e));return d(e,c,i)}function d(e,t,n){if(t<-3)return e.toString();if(t<3){var i=Math.max(n-t-1,0);return e.toFixed(i)}var r=["K","M","B","T"],a=Math.min(Math.floor(t/3),r.length),s=Math.pow(1e3,a),o=Math.max(0,3*a-t+n-1),l=r[a-1],u=c((e/s).toFixed(o));return u+l}function h(e,t){var n=[Math.min(0,e[0]),Math.max(0,e[1])],i=Math.max(n[1]-n[0]),r=40,s=5,o=Math.floor(Math.min(t/r,s)),l=i/o,c=Math.pow(10,a(l)+1),u=c;[2,4,5,10].forEach(function(e){var t=c/e;u=t>=l?t:u});for(var h=a(Math.abs(u)),f=a(Math.max(Math.abs(n[0]),Math.abs(n[1]))),p=u/Math.pow(10,h)===2.5?1:0,g=1+f-h+p,m=[],v=Math.ceil(n[0]/u)*u,y=v;y<e[1]+u;){var b={value:y,displayString:0===y?"0":d(y,f,g),rawString:0===y?"0":d(y,Math.min(0,f),0)};y+=u,m.push(b)}return m}function f(e){var t=0,n=0;return e.forEach(function(e,i){var r=!e||"null"===e.toLowerCase();r&&i===t?t=i+1:r||(n=i)}),[t,n]}function p(e){var t=e.substring(0,e.indexOf("?")),n=t.split(".").pop();return n.toLowerCase()}Object.defineProperty(e,"__esModule",{value:!0}),e.getFileExtension=e.getTrimmedExtent=e.getNiceIntervals=e.getRoundedValue=e.stringToNumber=e.camelToHyphen=e.parseQueryString=e.parseChartId=e.getChartId=void 0;var g=n(t);e.getChartId=i,e.parseChartId=r,e.parseQueryString=s,e.camelToHyphen=o,e.stringToNumber=l,e.getRoundedValue=u,e.getNiceIntervals=h,e.getTrimmedExtent=f,e.getFileExtension=p}),define("scripts/PageData",["exports","../shared/utils"],function(e,t){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=n(t),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(t){var n=this;i(this,e);var a=t.shift(),s=t.map(function(e){return a.reduce(function(t,n,i){return t[n]=e[i],t},{})});1!=a.length?!function(){var e=a.shift();n.indices=s.map(function(t){return t[e]})}():this.indices=s.map(function(e,t){return"Row "+(t+1)}),this.serieses=a.map(function(e,t){return{label:e,seriesIndex:t}}),this.data=a.map(function(e){return s.map(function(t,i){return{x:i,y:r.stringToNumber(t[e]),xLabel:n.indices[i],yRaw:t[e]}})})}return a(e,null,[{key:"fromJSON",value:function(t,n){var i=r.getFileExtension(t),a="tsv"==i?d3.tsv.parseRows(n):d3.csv.parseRows(n);return new e(a)}}]),e}();e.default=s}),define("scripts/ChartData",["exports","../shared/utils","./PageData"],function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=(i(n),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),s=function(){function e(t,n){r(this,e),this._data=t.data.filter(function(e,t){return n.indexOf(t)>-1}),this._serieses=t.serieses.filter(function(e,t){return n.indexOf(t)>-1}),this._indices=t.indices,this.formatData()}return a(e,[{key:"formatData",value:function(){var e=this;this._data[0].forEach(function(t,n){var i=0,r=0;e._data.forEach(function(t,a){var s=e._data[a][n];s.ySeries=a,s.y<0?(i+=s.y,s.y0=i,s.y1=s.y0-s.y):(s.y0=r,s.y1=s.y0+s.y,r+=s.y)})})}},{key:"getFlattenedData",value:function(){return this._data.reduce(function(e,t){return e.concat(t)})}},{key:"getSerieses",value:function(){return this._serieses}},{key:"getSeries",value:function(e){return this._serieses[e]}},{key:"getSeriesByIndex",value:function(e){for(var t=0;t<this._serieses.length;t++)if(this._serieses[t].seriesIndex==e)return this._serieses[t]}},{key:"getSeriesPositionByIndex",value:function(e){for(var t=0;t<this._serieses.length;t++)if(this._serieses[t].seriesIndex==e)return t;return-1}},{key:"getDatum",value:function(e,t){return this._data[e][t]}},{key:"getSeriesLabels",value:function(){return this._serieses.map(function(e){return e.label})}},{key:"getSeriesIndices",value:function(){return this._serieses.map(function(e){return e.seriesIndex})}},{key:"getSeriesCount",value:function(){return this._serieses.length}},{key:"getUnstackedValuesAtIndex",value:function(e){return this._data.map(function(t){return t[e].y})}},{key:"getValuesForSeries",value:function(e){var t=this.getSeriesExtent(e);return this._data[e].slice(t[0],t[1]+1)}},{key:"getFirstDatum",value:function(e){var t=this.getSeriesExtent(e)[0];return this._data[e][t]}},{key:"getLastDatum",value:function(e){var t=this.getSeriesExtent(e)[1];return this._data[e][t]}},{key:"getSeriesExtent",value:function(e){var n=this._data[e].map(function(e){return e.yRaw});return(0,t.getTrimmedExtent)(n)}},{key:"getIndices",value:function(){return this._indices}},{key:"getIndexCount",value:function(){return this._indices.length}},{key:"getStackedExtent",value:function(){return d3.extent(this.getFlattenedData(),function(e){return e.y<0?e.y0:e.y1})}},{key:"getStackedExtentForIndex",value:function(e){var t=[0,0];return this._data.forEach(function(n){var i=n[e].y<0?0:1;t[i]+=n[e].y}),t}},{key:"getUnstackedExtent",value:function(){return d3.extent(this.getFlattenedData(),function(e){return e.y})}},{key:"getIndexExtent",value:function(){return[this._indices[0],this._indices[this._indices.length-1]]}}]),e}();e.default=s}),define("scripts/Editor",["exports"],function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function e(n){var i=this;t(this,e),this.rootElement=n,this.listener=function(){},this.setContent(this.getContent()),this.rootElement.addEventListener("focusout",function(){var e=i.getContent();i.setContent(e),i.listener(e)})}return n(e,[{key:"onChange",value:function(e){this.listener=e}},{key:"getContent",value:function(){var e=this.rootElement.innerText;return e?e.trim():""}},{key:"setContent",value:function(e){if(!e)return this.rootElement.innerHTML="",void this.rootElement.classList.add("empty");var t=document.createElement("div");t.innerHTML=e;var n=t.innerText,i=(n||"").split("\n").map(function(e){return"<div>"+e+"</div>"}).join("");this.rootElement.innerHTML=i,this.rootElement.classList.remove("empty")}}]),e}();e.default=i}),define("scripts/templates",["exports"],function(e){function t(){return'\n    <div class="page-settings js-settings">\n      <button class="option-item settings" data-click="open-settings" title="Settings">\n        <span class="icon icon-settings"></span>\n      </button>\n\n      <div class="settings-popover popover">\n        <div class="page-options">\n          <a class="page-option-item js-downloadDataLink" title="Download data">\n            <span class="icon icon-download"></span>Download data\n          </a>\n\n          <button class="page-option-item toggle-color" data-click="toggle-color" title="Switch background color">\n            <span class="icon icon-color"></span>Switch background\n          </button>\n\n          <div class="js-gridOption"></div>\n\n          <button class="page-option-item" data-click="get-embed" title="Get embed code">\n            <span class="icon icon-embed"></span>Get embed code\n          </button>\n\n          <div class="page-data-source">\n            <label>Update data source</label>\n            <div class="page-data-source-form">\n              <input class="js-dataSourceUrl">\n              <button data-click="update-data-source">Go</button>\n            </div>\n          </div>\n        </div>\n\n        <a href="/" class="page-option-item">\n          <span class="icon icon-back"></span>Charted home\n        </a>\n      </div>\n    </div>\n  '}function n(e){var t='<script src="'+window.location.origin+'/embed.js" data-charted="'+e+'"></script>';return'\n    <div class="overlay-container js-embedPopup">\n      <div class="overlay-content">\n        <h1 class="overlay-title">Embed this Charted page</h1>\n        <p class="overlay-description">\n          You can add this embed to your website by copying and pasting the HTML code below.\n        </p>\n\n        <textarea class="embed-link">'+t+'</textarea>\n        <div class="iframe-container">'+t+'</div>\n      </div>\n      <div class="overlay-close" data-click="close-embed"><span class="icon icon-x"></span></div>\n    </div>\n  '}function i(){return'\n    <button class="page-option-item" data-click="toggle-grid" title="Show full width charts">\n      <span class="icon icon-full-screen"></span>Show full width charts\n    </button>\n  '}function r(){return'\n    <button class="page-option-item" data-click="toggle-grid" title="Show split-screen charts">\n      <span class="icon icon-split-screen"></span>Show split-screen charts\n    </button>\n  '}function a(e){return'\n    <div class="y-axis-label" style="top:'+e.top+'px">'+e.display+"</div>\n  "}function s(e){var t="",n="";return e.editable&&(t='contenteditable="true"',n='\n      <div class="chart-options js-chartOptions">\n        <a class="option-item toggle-type" data-click="toggle-type" href="#" title="Switch chart type">\n          <span class="icon icon-line"></span>\n          <span class="icon icon-column"></span>\n        </a>\n\n        <a class="option-item toggle-rounding" data-click="toggle-rounding" href="#" title="Turn rounding on/off">\n          <span class="icon icon-round-off"></span>\n          <span class="icon icon-round-on"></span>\n        </a>\n      </div>\n    '),'\n    <div class="chart js-chart show-columns">\n      <div class="chart-description js-chartDescription">\n        <h1 class="js-chartTitle title info-input" '+t+'></h1>\n        <div class="js-chartNote note info-input" '+t+'></div>\n      </div>\n\n      <div class="chart-plot-outer-container">\n        <div class="chart-plot-inner-container">\n          <div class="y-axis-container"><div class="y-axis js-yAxis chart-height"></div></div>\n          <div class="zero-line-container chart-height"><div class="zero-line js-zeroLine"></div></div>\n          <div class="x-axis"><span class="js-xBeg x-beginning"></span><span class="js-xEnd x-end"></span></div>\n          <div class="selection js-selection">\n            <div class="selection-info">\n              <div class="selection-value js-selectionValue"></div>\n              <div class="selection-xlabel js-selectionXLabel"></div>\n              <div class="selection-ylabel js-selectionYLabel"></div>\n            </div>\n          </div>\n          <figure class="chart-plot chart-height js-chartPlot"></figure>\n        </div>\n      </div>\n\n      <aside class="chart-info">\n        <ul class="legend js-legend hidden"></ul>\n        '+n+"\n      </aside>\n    </div>\n  ";
}function o(e){return'\n    <div class="change-series-color popover js-changeSeriesColor">\n      <p>Change color:</p>\n      <p>\n        <span contenteditable="true" class="color-hex-input js-colorEditor">'+e.colorHex+'</span>\n      </p>\n      <span class="arrow-bottom-left"></span>\n    </div>\n  '}function l(e){var t="",n="";return e.editable&&(t='contenteditable="true"',n='\n      <button class="move-chart" data-click="open-move-chart" data-series-index="'+e.seriesIndex+'">\n        <span class="icon icon-move"></span>\n      </button>'),'\n    <li class="legend-item js-legendItem" data-series-index="'+e.seriesIndex+'">\n      <div class="legend-label info-input">\n        <span class="legend-input js-legendLabel" '+t+">"+e.label+'</span>\n      </div>\n      <button class="legend-color" data-click="open-color-input" data-series-index="'+e.seriesIndex+'">\n        <span style="background-color:'+e.color+';" class="legend-dot"></span>\n      </button>\n      '+n+"\n    </li>\n  "}function c(e){var t=e.otherCharts.map(function(t){return'\n      <a href= "#" class="move-chart-option" data-click="move-to-chart" data-dest="'+t.chartIndex+'" data-position="'+e.position+'">\n        '+t.title+"\n      </a>\n    "}).join("\n"),n="";return e.series.length>1&&(n='\n      <a href= "#" class="move-chart-option" data-click="move-to-chart" data-dest="'+e.newChartIndex+'" data-position="'+e.position+'">\n        <span class="icon icon-plus"></span>New chart\n      </a>\n    '),'\n    <div class="move-chart-options popover js-moveChartOptions">\n      <p>Move to:</p>\n      '+t+"\n      "+n+'\n      <span class="arrow-bottom-right"></span>\n    </div>\n  '}Object.defineProperty(e,"__esModule",{value:!0}),e.pageSettings=t,e.embedOverlay=n,e.gridSettingsFull=i,e.gridSettingsSplit=r,e.yAxisLabel=a,e.chart=s,e.changeSeriesColor=o,e.legendItem=l,e.moveChart=c}),define("scripts/dom",["exports"],function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){if(!e)throw"Assertion error";return e}function i(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function r(e){var t=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=e;n.firstChild;)t.appendChild(n.removeChild(n.firstChild));return t}function a(e,t){return t=t||document.body,/^js\-/.test(e)?t.querySelector("."+e):null}function s(e,t){return t=t||document.body,/^js\-/.test(e)?Array.prototype.slice.call(t.querySelectorAll("."+e)):[]}function o(e,t){return t=t||document.body,Array.prototype.slice.call(t.querySelectorAll(e))}function l(e){return e.getBoundingClientRect()}Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=function(){function e(){t(this,e)}return c(e,[{key:"add",value:function(e,t){e&&e.classList.add(t)}},{key:"remove",value:function(e,t){e&&e.classList.remove(t)}},{key:"enable",value:function(e,t,n){n?this.add(e,t):this.remove(e,t)}},{key:"toggle",value:function(e,t){e&&(e.classList.contains(t)?this.remove(e,t):this.add(e,t))}}]),e}();e.default={assert:n,get:a,getAll:s,queryAll:o,rect:l,renderFragment:r,remove:i,classlist:new u}}),define("scripts/ChartLegend",["exports","./Actions","./Chart","./ChartData","./PageController","./Editor","./templates","./dom"],function(e,t,n,i,r,a,s,o){function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var d=c(t),h=(c(n),c(i),c(a)),f=l(s),p=c(o),g=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),m=function(){function e(t,n,i){u(this,e),this.chart=i,this.controller=t,this.data=n,this.chartIndex=this.chart.getChartIndex(),this.series=this.chart.getChartSeries(),this.actions=new d.default(this.chart.container)}return g(e,[{key:"activate",value:function(){this.actions.add("open-color-input",this.openColorInput,this).add("open-move-chart",this.openMoveChart,this).add("move-to-chart",this.moveToChart,this).activate()}},{key:"deactivate",value:function(){this.actions.deactivate(),delete this.actions}},{key:"getLegendElement",value:function(e){var t=p.default.get('js-legendItem[data-series-index="'+e+'"]');if(t)return t;throw"Legend item with index "+e+" not found"}},{key:"update",value:function(){var e=this;if(1===this.data.getSeriesCount()&&0===this.controller.getOtherCharts(this.chartIndex).length){var t=p.default.get("js-legend",this.chart.container);return void(t&&(t.innerHTML=""))}for(var n=document.createDocumentFragment(),i=this.data.getSerieses(),r=i.length-1;r>=0;r--){var a=i[r],s=this.controller.getSeriesName(this.series[r]),o=p.default.renderFragment(f.legendItem({label:s,color:this.chart.getSeriesColor(a.seriesIndex),editable:this.controller.getEditability(),seriesIndex:a.seriesIndex}));n.appendChild(o)}var l=p.default.get("js-legend",this.chart.container);l&&(l.innerHTML="",l.appendChild(n),p.default.classlist.remove(l,"hidden"));var c=this.controller.params.seriesNames;this.controller.getEditability()&&this.data.getSerieses().forEach(function(t){var n=p.default.get("js-legendLabel",e.getLegendElement(t.seriesIndex));if(!n)throw"Legend label for legend "+t.seriesIndex+" not found";var i=new h.default(n);i.onChange(function(n){""===!n||n===t.label?(i.setContent(t.label),delete c[t.seriesIndex]):c[t.seriesIndex]=n,e.controller.updateURL()})})}},{key:"openColorInput",value:function(e){var t=this;this.controller.removePopovers();var n=Number(e.getAttribute("data-series-index")),i=this.getLegendElement(n),r=this.chart.getSeriesColor(n).replace(/^#/,"");p.default.classlist.add(i,"active-color-input");var a=p.default.renderFragment(f.changeSeriesColor({colorHex:r,seriesIndex:n}));i.appendChild(a);var s=p.default.assert(p.default.get("js-colorEditor",i));s.addEventListener("focusout",function(){var e=t.controller.params.seriesColors,i="";s.innerText&&(i="#"+s.innerText.replace(/^#/,"").trim());var r=t.chart.getDefaulSeriesColor(n),a=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(i);i!==r&&a?e[n]=i:(s.innerHTML=r,delete e[n]),t.chart.render(),t.controller.updateURL()})}},{key:"openMoveChart",value:function(e){this.controller.removePopovers();var t=Number(e.getAttribute("data-series-index")),n=this.data.getSeriesByIndex(t);if(!n)throw"Series "+t+" not found";var i=this.data.getSeriesPositionByIndex(t);if(i<0)throw"Series "+t+" not found";var r=this.controller.getOtherCharts(this.chartIndex),a=r.length+1;if(0===r.length)this.controller.moveToChart(this.series[i],this.chartIndex,a);else if(1===r.length&&1===this.series.length)this.controller.moveToChart(this.series[i],this.chartIndex,r[0].chartIndex);else{var s=this.getLegendElement(n.seriesIndex);p.default.classlist.add(s,"active"),s.appendChild(p.default.renderFragment(f.moveChart({position:i,otherCharts:r,series:this.series,newChartIndex:a})))}}},{key:"moveToChart",value:function(e){var t=this.chartIndex,n=Number(e.getAttribute("data-dest")),i=this.series[Number(e.getAttribute("data-position"))];this.controller.moveToChart(i,t,n)}}]),e}();e.default=m}),define("scripts/Chart",["exports","./Actions","./ChartData","./ChartLegend","../shared/utils","./PageController","./PageData","./Editor","./templates","./dom"],function(e,t,n,i,r,a,s,o,l,c){function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var f=d(t),p=d(n),g=d(i),m=(d(s),d(o)),v=u(l),y=d(c),b=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),x=function(){function e(t,n,i,r,a){var s=this;h(this,e),this.pageController=t,this.wrapper=i;var o={editable:t.getEditability()};this.wrapper.innerHTML=v.chart(o),this.container=y.default.assert(y.default.get("js-chart",this.wrapper)),this.plot=y.default.assert(y.default.get("js-chartPlot",this.container)),this.xBeg=y.default.assert(y.default.get("js-xBeg",this.container)),this.xEnd=y.default.assert(y.default.get("js-xEnd",this.container)),this.selectionElem=y.default.assert(y.default.get("js-selection",this.container)),this.selectionXLabel=y.default.assert(y.default.get("js-selectionXLabel",this.container)),this.selectionYLabel=y.default.assert(y.default.get("js-selectionYLabel",this.container)),this.selectionValue=y.default.assert(y.default.get("js-selectionValue",this.container)),this.yAxis=y.default.assert(y.default.get("js-yAxis",this.container)),this.zeroLine=y.default.assert(y.default.get("js-zeroLine",this.container)),this.optionsElem=y.default.assert(y.default.get("js-chartOptions",this.container)),this.chartDescription=y.default.assert(y.default.get("js-chartDescription",this.container)),this.pageSettings=y.default.assert(y.default.get("js-settings"));var l=y.default.assert(y.default.get("js-chartTitle",this.container));this.titleEditor=new m.default(l),this.titleEditor.onChange(function(e){return e?(s.params.title=e,void s.pageController.updateURL()):(s.params.title=s.pageController.getDefaultTitle(s.chartIndex),void s.titleEditor.setContent(s.params.title))});var c=y.default.assert(y.default.get("js-chartNote",this.container));this.noteEditor=new m.default(c),this.noteEditor.onChange(function(e){s.params.note=e,s.pageController.updateURL()}),this.refresh(n,r,a),this.actions=new f.default(this.container),this.bindInteractions()}return b(e,[{key:"activate",value:function(){this.actions.add("toggle-type",this.toggleType,this).add("toggle-rounding",this.toggleRounding,this).activate()}},{key:"deactivate",value:function(){this.actions.deactivate(),delete this.actions}},{key:"refresh",value:function(e,t,n){this.chartIndex=e,this.params=t,this.data=new p.default(n,this.params.series),this.legend&&this.legend.deactivate(),this.legend=new g.default(this.pageController,this.data,this),this.legend.activate(),this.setupChart(),this.render()}},{key:"setupChart",value:function(){this.plot.innerHTML="",this.titleEditor.setContent(this.params.title),this.noteEditor.setContent(this.params.note),this.xBeg.innerHTML=this.data.getIndexExtent()[0],this.xEnd.innerHTML=this.data.getIndexExtent()[1],this.setScales(),this.createChartElements()}},{key:"setScales",value:function(){var e=this;this.xScale=d3.scale.linear().domain([0,this.data.getIndexCount()]),this.xPosition=function(t){return Math.floor(e.xScale(t.x),0)},this.xBarWidth=function(t){var n=e.plotWidth/e.data.getIndexCount()>=8?1:0,i=t.x+1<e.data.getIndexCount()?e.xScale(t.x+1):e.plotWidth;return Math.floor(i,0)-e.xPosition(t)-n},this.xPositionLine=function(t){return e.xPosition(t)+.5*e.xBarWidth(e.data.getDatum(0,t.x))},this.yScale=d3.scale.linear(),this.yPosition=function(t){return e.yScale(t.y)},this.yPositionStacked=function(t){return e.yScale(t.y1)},this.yHeightStacked=function(t){return 0===t.y?0:e.yScale(t.y0)-e.yScale(t.y1)+1},this.yRangeStacked=this.data.getStackedExtent(),this.yRangeUnstacked=this.data.getUnstackedExtent(),this.colorLight="#333333",this.colorDark="#FFFFFF",this.colorRange=["#6DCC73","#1D7775","#4FCFD5","#FCE651","#FF7050","#FFC050","#999999"]}},{key:"createChartElements",value:function(){this.svg=d3.select(this.plot).append("svg"),this.line=d3.svg.line().interpolate("cardinal").tension(.96).x(this.xPositionLine).y(this.yPosition),this.layerGroup=this.svg.append("g").attr("class","layers"),this.layers=this.layerGroup.selectAll("g").data(this.data.getSeriesIndices()).enter().append("g").attr("class","layer");var e=this;this.layers.each(function(t,n){var i=d3.select(this);i.append("path").attr("class","line").each(function(){e.data.getSeries(n).lineEl=this}),i.selectAll("rect").data(e.data.getValuesForSeries(n)).enter().append("rect").attr("class","column").each(function(t){e.data.getDatum(n,t.x).columnEl=this}),i.append("circle").attr("class","end-dot last-dot").attr("r",3),i.append("circle").attr("class","end-dot first-dot").attr("r",3),i.append("circle").attr("class","selected-dot").attr("r",4)})}},{key:"updateSizes",value:function(){var e=y.default.rect(this.plot),t=y.default.rect(this.xBeg);this.margin={top:4,right:4,bottom:0,left:0},this.width=e.width,this.plotWidth=this.width-this.margin.right-this.margin.left,this.height=e.height,this.svg.attr("width",this.width).attr("height",this.height),this.xScale.range([this.margin.left,this.width-this.margin.right-this.margin.left]),this.yScale.range([this.height-this.margin.bottom,this.margin.top]),this.xEndEdge=y.default.rect(this.xEnd).left-e.left,this.xBegEdge=t.left-e.left+t.width}},{key:"render",value:function(){this.updateSizes(),y.default.classlist.enable(this.container,"rounding-off","off"===this.params.rounding),this.selectedX=this.data.getIndexCount()-1,this.applyChartColors(),this.applyChartType(),this.updateYAxis(),this.plotAll(),this.updateSelectedX(),this.legend.update()}},{key:"getDefaulSeriesColor",value:function(e){var t=this.data.getSeriesIndices();if(1===t.length)return this.pageController.params.isLight()?this.colorLight:this.colorDark;var n=t.indexOf(e),i=this.colorRange.length,r=n%i;return this.colorRange[r]}},{key:"getSeriesColor",value:function(e){return this.pageController.params.getSeriesColor(e)||this.getDefaulSeriesColor(e)}},{key:"applyChartColors",value:function(){var e=this;this.layers.each(function(t){var n=d3.select(this);n.selectAll(".line").attr("stroke",e.getSeriesColor(t)),n.selectAll(".column, .selected-column, .selected-dot, .end-dot").attr("fill",e.getSeriesColor(t))})}},{key:"applyChartType",value:function(){if(y.default.classlist.enable(this.container,"show-columns","column"===this.params.type),"column"===this.params.type)this.yRange=this.yRangeStacked,this.focusedSeriesIndex=this.data.getSeriesCount();else{this.yRange=this.yRangeUnstacked;var e=this.data.getUnstackedValuesAtIndex(this.selectedX);this.focusedSeriesIndex=e.indexOf(d3.max(e))}var t=function(e){var t=e[0]<0?1.1*e[0]:0;return[t,Math.max(0,e[1])]};this.yScale.domain(t(this.yRange))}},{key:"plotAll",value:function(){var e=this;this.layers.each(function(t,n){var i=d3.select(this);i.selectAll(".column").attr("x",e.xPosition).attr("y",e.yPositionStacked).attr("height",e.yHeightStacked).attr("width",e.xBarWidth),i.selectAll(".line").attr("d",e.line(e.data.getValuesForSeries(n)));var r=e.data.getFirstDatum(n),a=e.data.getLastDatum(n);i.selectAll(".last-dot").attr("cx",e.xPositionLine(a)).attr("cy",e.yPosition(a)),i.selectAll(".first-dot").attr("cx",e.xPositionLine(r)).attr("cy",e.yPosition(r))})}},{key:"updateYAxis",value:function(){var e=this,t="",n=(0,r.getNiceIntervals)(this.yRange,this.height),i=y.default.rect(this.yAxis).height-y.default.rect(this.container).height+60;n.forEach(function(n){n.top=e.yScale(n.value),n.top>=i&&(n.display="on"===e.params.rounding?n.displayString:n.rawString,t+=v.yAxisLabel(n))}),this.yAxis.innerHTML=t,y.default.classlist.remove(this.zeroLine,"hidden");var a=this.zeroLine;a instanceof HTMLElement&&(a.style.top=this.yScale(0)+"px")}},{key:"updateSelectedX",value:function(e){void 0!=e&&(this.selectedX=e);var t=this.xPosition(this.data.getDatum(0,this.selectedX)),n=.5*this.xBarWidth(this.data.getDatum(0,this.selectedX)),i=t+n,r=this.selectionElem;r instanceof HTMLElement&&(r.style.left=i+"px");var a=y.default.rect(this.selectionXLabel),s=i,o=i+a.width,l=i<this.width/2;y.default.classlist.enable(this.selectionElem,"on-right",l),l||(s=i-a.width,o=i),y.default.classlist.enable(this.xBeg,"hidden",s<=this.xBegEdge),y.default.classlist.enable(this.xEnd,"hidden",o>=this.xEndEdge);var c=this;this.layers.each(function(e,t){var n=c.data.getSeriesExtent(t);c.selectedX>=n[0]&&c.selectedX<=n[1]?d3.select(this).selectAll(".selected-dot").attr("cx",c.xPositionLine(c.data.getDatum(t,c.selectedX))).attr("cy",c.yPosition(c.data.getDatum(t,c.selectedX))).style({opacity:"1"}):d3.select(this).selectAll(".selected-dot").style({opacity:"0"})});for(var u=this.data.getIndexCount(),d=0;d<u;d++){var h="column";c.selectedX===d&&(h="column selected");for(var f=0;f<c.data.getSeriesCount();f++){var p=c.data.getDatum(f,d).columnEl;p&&d3.select(p).attr("class",h)}}this.updateSelectionText()}},{key:"updateSelectionText",value:function(){var e=this.focusedSeriesIndex>=this.data.getSeriesCount(),t=e?this.data.getSeriesCount()-1:this.focusedSeriesIndex,n=this.data.getDatum(t,this.selectedX),i="",a=this.pageController.params.isLight()?this.colorLight:this.colorDark;if(e||null!=n.ySeries&&(a=this.getSeriesColor(this.data.getSeries(n.ySeries).seriesIndex)),this.data.getSeriesCount()>1){var s=this.getChartSeries()[t];i=e?"total":this.pageController.getSeriesName(s)}var o=this.data.getStackedExtentForIndex(this.selectedX),l=o[1]+o[0],c=e?l:(0,r.stringToNumber)(n.yRaw),u="on"===this.params.rounding?(0,r.getRoundedValue)(c,this.yRange):c;this.selectionYLabel.innerHTML=i,this.selectionXLabel.innerHTML=n.xLabel,this.selectionValue.innerHTML=String(u);var d=this.selectionYLabel;d instanceof HTMLElement&&(d.style.color=a);var h=this.selectionValue;h instanceof HTMLElement&&(h.style.color=a)}},{key:"bindInteractions",value:function(){this.container.addEventListener("mousemove",this.handleMousemove.bind(this))}},{key:"toggleType",value:function(){var e=a.OPTIONS.type;this.params.type=this.params.type===e[0]?e[1]:e[0],this.render(),this.pageController.updateURL()}},{key:"toggleRounding",value:function(){var e=a.OPTIONS.rounding;this.params.rounding=this.params.rounding===e[0]?e[1]:e[0],this.render(),this.pageController.updateURL()}},{key:"handleMousemove",value:function(e){y.default.classlist.add(this.container,"active"),y.default.classlist.add(document.body,"page-active");var t=y.default.rect(this.plot);if(!(e.clientY-t.top>t.height)){var n=this.getClosestPoint(e);n.selectedX===this.selectedX&&n.focusedSeriesIndex===this.focusedSeriesIndex||(this.selectedX=n.selectedX,this.focusedSeriesIndex=n.focusedSeriesIndex,this.updatefocusedSeriesIndex(),this.pageController.updateSelectedX(this.selectedX))}}},{key:"getClosestPoint",value:function(e){var t=this,n=y.default.rect(this.plot),i=(e.clientX-n.left)*this.data.getIndexCount()/(this.width-this.margin.right),r=e.clientY-n.top,a=Math.min(Math.floor(Math.max(i,0)),this.data.getIndexCount()-1),s=this.focusedSeriesIndex,o=d3.range(this.data.getSeriesCount()).map(function(e){var n=t.data.getDatum(e,a),i="line"===t.params.type?t.yPosition(n):t.yPositionStacked(n),s="line"===t.params.type?Math.abs(r-i):r-i,o="line"===t.params.type||s>0;return{diff:s,series:e,isValid:o}});if(o=o.filter(function(e){return e.isValid}),o.sort(function(e,t){return d3.ascending(e.diff,t.diff)}),s=o.length?o[0].series:0,"column"===this.params.type){var l=this.data.getStackedExtentForIndex(a),c=[this.yScale(l[0]),this.yScale(l[1])];(r<=c[1]||r>c[0])&&(s=this.data.getSeriesCount())}return{selectedX:a,focusedSeriesIndex:s}}},{key:"updatefocusedSeriesIndex",value:function(){if("line"===this.params.type){var e=y.default.queryAll(".line",this.container);e.forEach(function(e){return e.className="line"});var t=d3.select(this.data.getSeries(this.focusedSeriesIndex).lineEl);t.attr("class","line focused"),d3.select(t.node().parentNode).each(function(){this.parentNode.appendChild(this)})}}},{key:"getChartIndex",value:function(){return this.chartIndex}},{key:"getChartSeries",value:function(){return this.params.series}}]),e}();e.default=x}),define("scripts/ChartParameters",["exports","../shared/utils","../shared/sha1"],function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=r(t),o=(i(n),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),l="dark",c="light",u="full",d="split",h={type:["column","line"],rounding:["on","off"]},f=function(){function e(t){a(this,e),this.url=t,this.charts=[{}],this.seriesColors={},this.seriesNames={},this._color=c,this._grid=d,this._getDefaultTitle=function(e){return""}}return o(e,[{key:"withDefaultTitle",value:function(e){return this._getDefaultTitle=e,this}},{key:"isLight",value:function(){return this._color==c}},{key:"toggleColor",value:function(){this._color=this.isLight()?l:c}},{key:"isFull",value:function(){return this._grid==u}},{key:"toggleGrid",value:function(){this._grid=this.isFull()?d:u}},{key:"getSeriesColor",value:function(e){return this.seriesColors[e]}},{key:"getSeriesName",value:function(e){return this.seriesNames[e]}},{key:"compress",value:function(){var e=this,t={dataUrl:this.url};return Object.keys(this.seriesNames).length&&(t.seriesNames=this.seriesNames),Object.keys(this.seriesColors).length&&(t.seriesColors=this.seriesColors),this.isLight()||(t.color=this._color),this.isFull()&&(t.grid=this._grid),t.charts=this.charts.map(function(t,n){var i={};return Object.keys(h).forEach(function(e){t[e]&&t[e]!==h[e][0]&&(i[e]=t[e])}),t.title&&t.title!==e._getDefaultTitle(n)&&(i.title=t.title),t.note&&(i.note=t.note),n>0&&t.series&&(i.series=t.series),i}),1!==t.charts.length||Object.keys(t.charts[0]).length||delete t.charts,t}}],[{key:"fromJSON",value:function(t){var n=new e(t.dataUrl);return t.charts&&(n.charts=t.charts),t.seriesNames&&(n.seriesNames=t.seriesNames),t.seriesColors&&(n.seriesColors=t.seriesColors),t.grid&&(n._grid=t.grid),t.color&&(n._color=t.color),n}},{key:"fromQueryString",value:function(t){var n=s.parseQueryString(t),i=n.data;if(!i)return null;var r=i.csvUrl||i.dataUrl;if(!r)return null;var a=new e(r);return i.charts&&(a.charts=i.charts),i.seriesNames&&(a.seriesNames=i.seriesNames),i.seriesColors&&(a.seriesColors=i.seriesColors),i.grid&&(a._grid=i.grid),i.color&&(a._color=i.color),a}}]),e}();e.default=f}),define("scripts/PageController",["exports","./Actions","./PageData","./Chart","./ChartParameters","./dom","./templates","../shared/utils"],function(e,t,n,i,r,a,s,o){function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.PageController=e.OPTIONS=void 0;var d=c(t),h=c(n),f=c(i),p=c(r),g=c(a),m=l(s),v=l(o),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),b=18e5,x=e.OPTIONS={type:["column","line"],rounding:["on","off"]};e.PageController=function(){function e(){var t=this;u(this,e),this.actions=new d.default(document.body),this.isEmbed=!1,this.chartObjects=[],window.addEventListener("resize",function(){clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){return t.setDimensions()},30)});var n=g.default.get("js-loadDataForm");n&&n.addEventListener("submit",function(e){e.preventDefault();var n=g.default.get("js-dataFileInput"),i=n&&n instanceof HTMLInputElement?n.value:null;if(!i){var r="Youll need to paste in the URL to a .csv file or Google Spreadsheet first.";return void t.errorNotify(new Error(r))}t.fetchPageData(i,null,null)})}return y(e,[{key:"activate",value:function(){var e=this,t=/\/(c|embed)\/([a-z\d]{7})\/?$/.exec(window.location.pathname),n=t&&t[2],i=p.default.fromQueryString(window.location.search||"");return this.actions.add("toggle-color",this.toggleColor,this).add("toggle-grid",this.toggleGrid,this).add("open-settings",this.openSettings,this).add("get-embed",this.getEmbed,this).add("close-embed",this.closeEmbed,this).add("update-data-source",this.updateDataSource,this).add("remove-popovers",this.removePopovers,this).activate(),n||i?(this.isEmbed=t&&"embed"==t[1],this.isEmbed||setInterval(function(){return e.fetchPageData()},b),n?void this.fetchPageData(null,n,null):void(i&&!function(){e.params=i.withDefaultTitle(function(t){return e.getDefaultTitle(t)});var t=e.params.compress(),n=t.dataUrl||null;e.updateURL(function(){return e.fetchPageData(n,null,t)})}())):(this.clearExisting(),void g.default.classlist.add(document.body,"pre-load"))}},{key:"fetchPageData",value:function(e,t,n){var i=this;if(!e&&!t){if(!this.params)return;t=v.getChartId(this.params.compress())}if(g.default.classlist.add(document.body,"loading"),this.updatePageTitle("Charted (...)"),this.clearExisting(),e){var r=g.default.get("js-dataFileInput");r&&r instanceof HTMLInputElement&&(r.value=e)}var a="/load/?url="+encodeURIComponent(e||"")+"&id="+encodeURIComponent(t||"");d3.json(a,function(e,t){if(e)return void i.errorNotify(e);if(!t.data||!t.data.length)return void i.errorNotify(new Error("Missing data from source: "+t.params.dataUrl));var r=n?n:t.params;r.dataUrl=t.params.dataUrl,i.params=p.default.fromJSON(r).withDefaultTitle(function(e){return i.getDefaultTitle(e)}),i.data=new h.default.fromJSON(i.params.url,t.data),i.render()})}},{key:"render",value:function(){var e=this,t=this.params.isLight()?"light":"dark";g.default.classlist.add(document.body,t),this.applyEmbed(),this.setupPageSettings(),this.params.charts[0].title||(this.params.charts[0].title=this.data.serieses.length>1?"Chart":this.data.serieses[0].label);var n=["pre-load","loading","error"];n.forEach(function(e){return g.default.classlist.remove(document.body,e)}),this.params.charts.forEach(function(t,n){return e.updateChart(n)}),this.setDimensions(),this.updateURL(),this.setDataSourceUrl(this.params.url)}},{key:"clearExisting",value:function(){var e=g.default.getAll("js-chartWrapper");e.forEach(function(e){return g.default.remove(e)}),g.default.remove(g.default.get("js-settings")),this.chartObjects=[]}},{key:"setupPageSettings",value:function(){if(!this.isEmbed){var e=g.default.renderFragment(m.pageSettings());document.body.appendChild(e);var t=this.params.url,n=g.default.get("js-downloadDataLink");n&&n.setAttribute("href",t),this.setDataSourceUrl(t)}}},{key:"updateChart",value:function(e){var t=this.getFullParams(e);0===t.series.length?this.removeChart(e):e<=this.chartObjects.length-1?this.chartObjects[e].refresh(e,t,this.data):this.createNewChart(e,this.getFullParams(e))}},{key:"getFirstChartSeries",value:function(){for(var e=[],t=[],n=1;n<this.params.charts.length;n++)e=e.concat(this.params.charts[n].series);for(var i=0;i<this.data.serieses.length;i++)e.indexOf(i)>-1||t.push(i);return t}},{key:"createNewChart",value:function(e,t){var n=this.getChartDimensions(),i=document.createElement("div");i.style.height=n.height+"px",i.style.width=n.width+"px",g.default.classlist.add(i,"chart-wrapper"),g.default.classlist.add(i,"js-chartWrapper");var r=g.default.get("js-charts");if(r){r.appendChild(i);var a=new f.default(this,e,i,t,this.data);a.activate(),this.chartObjects.push(a)}}},{key:"moveToChart",value:function(e,t,n){var i=this,r=this.params.charts[t],a=this.params.charts[n];this.params.charts.forEach(function(e,t){e.title&&e.title==i.getDefaultTitle(t)&&delete e.title}),n>this.params.charts.length-1?this.params.charts.push({series:[e]}):n>0&&(a.series.push(e),a.series.sort(function(e,t){return e-t})),t>0&&(r.series=r.series.filter(function(t){return t!==e})),this.updateChart(n),this.updateChart(t);for(var s=t;s<this.chartObjects.length;s++)s!==n&&this.updateChart(s);this.setDimensions(),this.updateURL()}},{key:"removeChart",value:function(e){for(var t=e+1;t<this.chartObjects.length;t++)this.chartObjects[t].chartIndex--;this.params.charts.splice(e,1),g.default.remove(this.chartObjects[e].wrapper),this.chartObjects[e].deactivate(),this.chartObjects.splice(e,1)}},{key:"getFullParams",value:function(e){var t=this.params.charts[e];return Object.keys(x).forEach(function(e){t[e]=t[e]||x[e][0]}),0===e&&(t.series=this.getFirstChartSeries()),t.title=t.title||this.getDefaultTitle(e),t}},{key:"getDefaultTitle",value:function(e){var t=this.params.charts[e].series;if(!t||!this.data)return"Charted";if(1===t.length)return this.getSeriesName(t[0]);var n=this.params.charts.filter(function(t,n){return t.series.length>0&&n<e});return 0===e?"Chart":"Chart "+(1+n.length)}},{key:"getSeriesName",value:function(e){return this.params.getSeriesName(e)||this.data.serieses[e].label}},{key:"getChartCount",value:function(){return this.params.charts.length}},{key:"getOtherCharts",value:function(e){var t=this;return this.params.charts.map(function(e,n){return{title:e.title||t.getDefaultTitle(n),chartIndex:n}}).filter(function(t,n){return n!==e})}},{key:"updateSelectedX",value:function(e){this.chartObjects.forEach(function(t){t.updateSelectedX(e)})}},{key:"toggleColor",value:function(){this.params.toggleColor(),g.default.classlist.toggle(document.body,"dark"),this.chartObjects.forEach(function(e){e.render()}),this.updateURL()}},{key:"openSettings",value:function(){g.default.classlist.add(g.default.get("js-settings"),"open")}},{key:"toggleGrid",value:function(){this.params.toggleGrid(),this.applyGrid(),this.setDimensions(),this.updateURL()}},{key:"applyGrid",value:function(){g.default.classlist.toggle(document.body,"full");var e=m.gridSettingsFull;this.params&&this.params.isFull()&&(e=m.gridSettingsSplit);var t=this.chartObjects?this.chartObjects.length:0,n=g.default.get("js-gridOption");n&&t>1&&n.appendChild(g.default.renderFragment(e()))}},{key:"getEmbed",value:function(){var e=this.params.compress(),t=v.getChartId(e),n=g.default.renderFragment(m.embedOverlay(t));document.body.appendChild(n)}},{key:"closeEmbed",value:function(){var e=document.querySelector(".js-embedPopup");e&&e.parentNode&&e.parentNode.removeChild(e)}},{key:"updateDataSource",value:function(){var e=document.querySelector(".js-dataSourceUrl");e&&e instanceof HTMLInputElement&&this.fetchPageData(e.value,null,this.params)}},{key:"setDataSourceUrl",value:function(e){var t=document.querySelector(".js-dataSourceUrl");t&&t instanceof HTMLInputElement&&(t.value=e)}},{key:"applyEmbed",value:function(){g.default.classlist.enable(document.body,"embed",this.isEmbed)}},{key:"removePopovers",value:function(){g.default.classlist.remove(g.default.get("js-settings"),"open");var e=g.default.getAll("js-legendItem");e.forEach(function(e){g.default.classlist.remove(e,"active"),g.default.classlist.remove(e,"active-color-input")});var t=["js-moveChartOptions","js-changeSeriesColor"];t.forEach(function(e){g.default.remove(g.default.get(e))})}},{key:"getEditability",value:function(){return!this.isEmbed}},{key:"getChartDimensions",value:function(){var e=600,t=1200,n=800,i=window.innerWidth,r="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,a=i>n?r:"auto",s=this.chartObjects?this.chartObjects.length:0,o=s>=2&&i>t&&!this.params.isFull(),l=r>e&&i>n,c=s>=3||2===s&&!o,u=l&&c;return{width:o?i/2:i,height:u?r/2:a,isHalfHeight:u,isGrid:o}}},{key:"setDimensions",value:function(){var e=this.getChartDimensions();g.default.classlist.enable(document.body,"chart-grid",e.isGrid),
g.default.classlist.enable(document.body,"half-height",e.isHalfHeight),g.default.getAll("js-chartWrapper").forEach(function(t){t instanceof HTMLElement&&(t.style.height=e.height+"px",t.style.width=e.width+"px")});var t=2*Math.floor((this.chartObjects.length-1)/2);this.chartObjects.forEach(function(n,i){g.default.classlist.enable(n.wrapper,"bottom-row",e.isGrid&&i>=t),n.render()}),this.applyGrid(),this.maybeBroadcastDimensions()}},{key:"maybeBroadcastDimensions",value:function(){if(this.isEmbed){var e=window.location.toString().replace("/c/","/embed/"),t=document.body.scrollHeight;t=t>600&&document.body.offsetWidth>=800?600:t;var n={chartId:v.getChartId(this.params.compress()),src:e,context:"iframe.resize",height:t};window.parent&&window.parent.postMessage(JSON.stringify(n),"*")}}},{key:"errorNotify",value:function(e){g.default.classlist.add(document.body,"error"),g.default.classlist.remove(document.body,"loading"),this.updatePageTitle();var t=e.message||e.responseText||"Theres been an error. Please check that you are using a valid .csv file. If you are using a Google Spreadsheet or Dropbox link, the privacy setting must be set to shareable.",n=g.default.get("js-errorMessage");n&&n.appendChild(g.default.renderFragment(t))}},{key:"updateURL",value:function(e){this.updatePageTitle();var t=this.params.compress(),n=v.getChartId(t),i="/c/"+n;window.history.pushState({},null,i),d3.xhr(i).header("Content-Type","application/json").post(JSON.stringify(t),function(){e&&e()})}},{key:"updatePageTitle",value:function(e){var t=this,n="Charted",i=[];this.params&&this.params.charts&&(i=this.params.charts),e?n=e:i.length>0&&(n=i.map(function(e,n){return e.title||t.getDefaultTitle(n)}).join(", "),"Chart"===n&&(n+=" of "+i[0].series.map(function(e){return t.getSeriesName(e)}).join(", "))),document.title=n}}]),e}()}),define("scripts/charted",["./PageController"],function(e){window.__charted=new e.PageController,window.__charted.activate()});