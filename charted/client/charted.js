/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.22 Copyright (c) 2010-2015, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/**
   * SHA-1 implementation.
   *
   * Adopted from SHA-1 implementation in JavaScript by Chris Veness.
   * (c) Chris Veness 2002-2014 / MIT Licence
   *
   * See:
   *  http://csrc.nist.gov/groups/ST/toolkit/secure_hashing.html
   *  http://csrc.nist.gov/groups/ST/toolkit/examples.html
   */

var requirejs,require,define;!function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var i;for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}}function eachReverse(e,t){if(e){var i;for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,n){return t&&eachProp(t,function(t,r){!i&&hasProp(e,r)||(!n||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,i,n)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,n){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=n,i&&(r.originalError=i),r}function newContext(e){function t(e){var t,i;for(t=0;t<e.length;t++)if(i=e[t],"."===i)e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function i(e,i,n){var r,a,s,o,l,c,u,h,d,f,p,g,m=i&&i.split("/"),v=k.map,y=v&&v["*"];if(e&&(e=e.split("/"),u=e.length-1,k.nodeIdCompat&&jsSuffixRegExp.test(e[u])&&(e[u]=e[u].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&m&&(g=m.slice(0,m.length-1),e=g.concat(e)),t(e),e=e.join("/")),n&&v&&(m||y)){s=e.split("/");e:for(o=s.length;o>0;o-=1){if(c=s.slice(0,o).join("/"),m)for(l=m.length;l>0;l-=1)if(a=getOwn(v,m.slice(0,l).join("/")),a&&(a=getOwn(a,c))){h=a,d=o;break e}!f&&y&&getOwn(y,c)&&(f=getOwn(y,c),p=o)}!h&&f&&(h=f,d=p),h&&(s.splice(0,d,h),e=s.join("/"))}return r=getOwn(k.pkgs,e),r?r:e}function n(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===x.contextName)return t.parentNode.removeChild(t),!0})}function r(e){var t=getOwn(k.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),x.require.undef(e),x.makeRequire(null,{skipMap:!0})([e]),!0}function a(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function s(e,t,n,r){var s,o,l,c,u=null,h=t?t.name:null,d=e,f=!0,p="";return e||(f=!1,e="_@r"+(T+=1)),c=a(e),u=c[0],e=c[1],u&&(u=i(u,h,r),o=getOwn(M,u)),e&&(u?p=o&&o.normalize?o.normalize(e,function(e){return i(e,h,r)}):e.indexOf("!")===-1?i(e,h,r):e:(p=i(e,h,r),c=a(p),u=c[0],p=c[1],n=!0,s=x.nameToUrl(p))),l=!u||o||n?"":"_unnormalized"+(D+=1),{prefix:u,name:p,parentMap:t,unnormalized:!!l,url:s,originalName:d,isDefine:f,id:(u?u+"!"+p:p)+l}}function o(e){var t=e.id,i=getOwn(w,t);return i||(i=w[t]=new x.Module(e)),i}function l(e,t,i){var n=e.id,r=getOwn(w,n);!hasProp(M,n)||r&&!r.defineEmitComplete?(r=o(e),r.error&&"error"===t?i(r.error):r.on(t,i)):"defined"===t&&i(M[n])}function c(e,t){var i=e.requireModules,n=!1;t?t(e):(each(i,function(t){var i=getOwn(w,t);i&&(i.error=e,i.events.error&&(n=!0,i.emit("error",e)))}),n||req.onError(e))}function u(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(x.defQueueMap[t]=!0),O.push(e)}),globalDefQueue=[])}function h(e){delete w[e],delete E[e]}function d(e,t,i){var n=e.map.id;e.error?e.emit("error",e.error):(t[n]=!0,each(e.depMaps,function(n,r){var a=n.id,s=getOwn(w,a);!s||e.depMatched[r]||i[a]||(getOwn(t,a)?(e.defineDep(r,M[a]),e.check()):d(s,t,i))}),i[n]=!0)}function f(){var e,t,i=1e3*k.waitSeconds,a=i&&x.startTime+i<(new Date).getTime(),s=[],o=[],l=!1,u=!0;if(!y){if(y=!0,eachProp(E,function(e){var i=e.map,c=i.id;if(e.enabled&&(i.isDefine||o.push(e),!e.error))if(!e.inited&&a)r(c)?(t=!0,l=!0):(s.push(c),n(c));else if(!e.inited&&e.fetched&&i.isDefine&&(l=!0,!i.prefix))return u=!1}),a&&s.length)return e=makeError("timeout","Load timeout for modules: "+s,null,s),e.contextName=x.contextName,c(e);u&&each(o,function(e){d(e,{},{})}),a&&!t||!l||!isBrowser&&!isWebWorker||S||(S=setTimeout(function(){S=0,f()},50)),y=!1}}function p(e){hasProp(M,e[0])||o(s(e[0],null,!0)).init(e[1],e[2])}function g(e,t,i,n){e.detachEvent&&!isOpera?n&&e.detachEvent(n,t):e.removeEventListener(i,t,!1)}function m(e){var t=e.currentTarget||e.srcElement;return g(t,x.onScriptLoad,"load","onreadystatechange"),g(t,x.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function v(){var e;for(u();O.length;){if(e=O.shift(),null===e[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));p(e)}x.defQueueMap={}}var y,b,x,C,S,k={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},w={},E={},$={},O=[],M={},P={},I={},T=1,D=1;return C={require:function(e){return e.require?e.require:e.require=x.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?M[e.map.id]=e.exports:e.exports=M[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(k.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},b=function(e){this.events=getOwn($,e.id)||{},this.map=e,this.shim=getOwn(k.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,i,n){n=n||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,x.startTime=(new Date).getTime();var e=this.map;return this.shim?void x.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;P[e]||(P[e]=!0,x.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,n=this.depExports,r=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){try{r=x.execCb(i,a,n,r)}catch(t){e=t}if(this.map.isDefine&&void 0===r&&(t=this.module,t?r=t.exports:this.usingExports&&(r=this.exports)),e){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",c(this.error=e);"undefined"!=typeof console&&console.error?console.error(e):req.onError(e)}}else r=a;if(this.exports=r,this.map.isDefine&&!this.ignore&&(M[i]=r,req.onResourceLoad)){var s=[];each(this.depMaps,function(e){s.push(e.normalizedMap||e)}),req.onResourceLoad(x,this.map,s)}h(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(x.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,n=s(e.prefix);this.depMaps.push(n),l(n,"defined",bind(this,function(n){var r,a,u,d=getOwn(I,this.map.id),f=this.map.name,p=this.map.parentMap?this.map.parentMap.name:null,g=x.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(f=n.normalize(f,function(e){return i(e,p,!0)})||""),a=s(e.prefix+"!"+f,this.map.parentMap),l(a,"defined",bind(this,function(e){this.map.normalizedMap=a,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),u=getOwn(w,a.id),void(u&&(this.depMaps.push(a),this.events.error&&u.on("error",bind(this,function(e){this.emit("error",e)})),u.enable()))):d?(this.map.url=x.nameToUrl(d),void this.load()):(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),r.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(w,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&h(e.map.id)}),c(e)}),r.fromText=bind(this,function(i,n){var a=e.name,l=s(a),u=useInteractive;n&&(i=n),u&&(useInteractive=!1),o(l),hasProp(k.config,t)&&(k.config[a]=k.config[t]);try{req.exec(i)}catch(e){return c(makeError("fromtexteval","fromText eval for "+t+" failed: "+e,e,[t]))}u&&(useInteractive=!0),this.depMaps.push(l),x.completeLoad(a),g([a],r)}),void n.load(e.name,g,r,k))})),x.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){E[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,n,r;if("string"==typeof e){if(e=s(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(C,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,l(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?l(e,"error",bind(this,this.errback)):this.events.error&&l(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,n=w[i],hasProp(C,i)||!n||n.enabled||x.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(w,e.id);t&&!t.enabled&&x.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},x={config:k,contextName:e,registry:w,defined:M,urlFetched:P,defQueue:O,defQueueMap:{},Module:b,makeModuleMap:s,nextTick:req.nextTick,onError:c,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=k.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(k[t]||(k[t]={}),mixin(k[t],e,!0,!0)):k[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(I[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,i){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=x.makeShimExports(e)),t[i]=e}),k.shim=t),e.packages&&each(e.packages,function(e){var t,i;e="string"==typeof e?{name:e}:e,i=e.name,t=e.location,t&&(k.paths[i]=e.location),k.pkgs[i]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(w,function(e,t){e.inited||e.map.unnormalized||(e.map=s(t,null,!0))}),(e.deps||e.callback)&&x.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,r){function a(i,n,l){var u,h,d;return r.enableBuildCallback&&n&&isFunction(n)&&(n.__requireJsBuild=!0),"string"==typeof i?isFunction(n)?c(makeError("requireargs","Invalid require call"),l):t&&hasProp(C,i)?C[i](w[t.id]):req.get?req.get(x,i,t,a):(h=s(i,t,!1,!0),u=h.id,hasProp(M,u)?M[u]:c(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(v(),x.nextTick(function(){v(),d=o(s(null,t)),d.skipMap=r.skipMap,d.init(i,n,l,{enabled:!0}),f()}),a)}return r=r||{},mixin(a,{isBrowser:isBrowser,toUrl:function(e){var n,r=e.lastIndexOf("."),a=e.split("/")[0],s="."===a||".."===a;return r!==-1&&(!s||r>1)&&(n=e.substring(r,e.length),e=e.substring(0,r)),x.nameToUrl(i(e,t&&t.id,!0),n,!0)},defined:function(e){return hasProp(M,s(e,t,!1,!0).id)},specified:function(e){return e=s(e,t,!1,!0).id,hasProp(M,e)||hasProp(w,e)}}),t||(a.undef=function(e){u();var i=s(e,t,!0),r=getOwn(w,e);r.undefed=!0,n(e),delete M[e],delete P[i.url],delete $[e],eachReverse(O,function(t,i){t[0]===e&&O.splice(i,1)}),delete x.defQueueMap[e],r&&(r.events.defined&&($[e]=r.events),h(e))}),a},enable:function(e){var t=getOwn(w,e.id);t&&o(e).enable()},completeLoad:function(e){var t,i,n,a=getOwn(k.shim,e)||{},s=a.exports;for(u();O.length;){if(i=O.shift(),null===i[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);p(i)}if(x.defQueueMap={},n=getOwn(w,e),!t&&!hasProp(M,e)&&n&&!n.inited){if(!(!k.enforceDefine||s&&getGlobal(s)))return r(e)?void 0:c(makeError("nodefine","No define call for "+e,null,[e]));p([e,a.deps||[],a.exportsFn])}f()},nameToUrl:function(e,t,i){var n,r,a,s,o,l,c,u=getOwn(k.pkgs,e);if(u&&(e=u),c=getOwn(I,e))return x.nameToUrl(c,t,i);if(req.jsExtRegExp.test(e))o=e+(t||"");else{for(n=k.paths,r=e.split("/"),a=r.length;a>0;a-=1)if(s=r.slice(0,a).join("/"),l=getOwn(n,s)){isArray(l)&&(l=l[0]),r.splice(0,a,l);break}o=r.join("/"),o+=t||(/^data\:|\?/.test(o)||i?"":".js"),o=("/"===o.charAt(0)||o.match(/^[\w\+\.\-]+:/)?"":k.baseUrl)+o}return k.urlArgs?o+((o.indexOf("?")===-1?"?":"&")+k.urlArgs):o},load:function(e,t){req.load(x,e,t)},execCb:function(e,t,i,n){return t.apply(n,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=m(e);x.completeLoad(t.id)}},onScriptError:function(e){var t=m(e);if(!r(t.id)){var i=[];return eachProp(w,function(e,n){0!==n.indexOf("_@r")&&each(e.depMaps,function(e){return e.id===t.id&&i.push(n),!0})}),c(makeError("scripterror",'Script error for "'+t.id+(i.length?'", needed by: '+i.join(", "):'"'),e,[t.id]))}}},x.require=x.makeRequire(),x}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,n){var r,a,s=defContextName;return isArray(e)||"string"==typeof e||(a=e,isArray(t)?(e=t,t=i,i=n):e=[]),a&&a.context&&(s=a.context),r=getOwn(contexts,s),r||(r=contexts[s]=req.s.newContext(s)),a&&r.configure(a),r.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var n=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return n.type=e.scriptType||"text/javascript",n.charset="utf-8",n.async=!0,n},req.load=function(e,t,i){var n,r=e&&e.config||{};if(isBrowser)return n=req.createNode(r,t,i),r.onNodeCreated&&r.onNodeCreated(n,r,t,i),n.setAttribute("data-requirecontext",e.contextName),n.setAttribute("data-requiremodule",t),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",e.onScriptLoad,!1),n.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",e.onScriptLoad)),n.src=i,currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{importScripts(i),e.completeLoad(t)}catch(n){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,n,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,i){var n,r;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript(),n&&(e||(e=n.getAttribute("data-requiremodule")),r=contexts[n.getAttribute("data-requirecontext")])),r?(r.defQueue.push([e,t,i]),r.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),define("shared/sha1",["exports"],function(e){function t(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=a(e);var s=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);for(var o=e.length/4+2,l=Math.ceil(o/16),c=new Array(l),u=0;u<l;u++){c[u]=new Array(16);for(var h=0;h<16;h++)c[u][h]=e.charCodeAt(64*u+4*h)<<24|e.charCodeAt(64*u+4*h+1)<<16|e.charCodeAt(64*u+4*h+2)<<8|e.charCodeAt(64*u+4*h+3)}c[l-1][14]=8*(e.length-1)/Math.pow(2,32),c[l-1][14]=Math.floor(c[l-1][14]),c[l-1][15]=8*(e.length-1)&4294967295;for(var d,f,p,g,m,v=1732584193,y=4023233417,b=2562383102,x=271733878,C=3285377520,S=new Array(80),u=0;u<l;u++){for(var k=0;k<16;k++)S[k]=c[u][k];for(var k=16;k<80;k++)S[k]=n(S[k-3]^S[k-8]^S[k-14]^S[k-16],1);d=v,f=y,p=b,g=x,m=C;for(var k=0;k<80;k++){var w=Math.floor(k/20),E=n(d,5)+i(w,f,p,g)+m+s[w]+S[k]&4294967295;m=g,g=p,p=n(f,30),f=d,d=E}v=v+d&4294967295,y=y+f&4294967295,b=b+p&4294967295,x=x+g&4294967295,C=C+m&4294967295}var $=r(v)+r(y)+r(b)+r(x)+r(C);return t?$.slice(0,7):$}function i(e,t,i,n){switch(e){case 0:return t&i^~t&n;case 1:return t^i^n;case 2:return t&i^t&n^i&n;case 3:return t^i^n}}function n(e,t){return e<<t|e>>>32-t}function r(e){for(var t,i="",n=7;n>=0;n--)t=e>>>4*n&15,i+=t.toString(16);return i}function a(e){return unescape(encodeURIComponent(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=t}),define("shared/utils",["exports","./sha1"],function(e,t){function i(e){return e&&e.__esModule?e:{default:e}}function n(e){return(0,g.default)(JSON.stringify(e),!0)}function r(e){var t=/\/(?:c|embed)\/(\w+)(?:|\?.*)?/.exec(e);return t?t[1]:null}function a(e){return Math.floor(Math.log(e)/Math.LN10,0)}function s(e){var t=e.slice(1);if(!t)return{};var i=t.split("&"),n={};return i.forEach(function(e){var t=e.split("=");1===t.length?n.data=JSON.parse(decodeURIComponent(t[0])):n[t[0]]=t[1]}),n}function o(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function l(e){return Number(String(e).replace(/[^0-9\.\-]/g,"")||0)}function c(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function u(e,t){var i=2,n=3,r=a(Math.abs(t[1])),s=a(Math.abs(t[0])),o=Math.abs(r-s),l=Math.max(r,s),c=o<=i?l:a(Math.abs(e));return h(e,c,n)}function h(e,t,i){if(t<-3)return e.toString();if(t<3){var n=Math.max(i-t-1,0);return e.toFixed(n)}var r=["K","M","B","T"],a=Math.min(Math.floor(t/3),r.length),s=Math.pow(1e3,a),o=Math.max(0,3*a-t+i-1),l=r[a-1],u=c((e/s).toFixed(o));return u+l}function d(e,t){var i=[Math.min(0,e[0]),Math.max(0,e[1])],n=Math.max(i[1]-i[0]),r=40,s=5,o=Math.floor(Math.min(t/r,s)),l=n/o,c=Math.pow(10,a(l)+1),u=c;[2,4,5,10].forEach(function(e){var t=c/e;u=t>=l?t:u});for(var d=a(Math.abs(u)),f=a(Math.max(Math.abs(i[0]),Math.abs(i[1]))),p=u/Math.pow(10,d)===2.5?1:0,g=1+f-d+p,m=[],v=Math.ceil(i[0]/u)*u,y=v;y<e[1]+u;){var b={value:y,displayString:0===y?"0":h(y,f,g),rawString:0===y?"0":h(y,Math.min(0,f),0)};y+=u,m.push(b)}return m}function f(e){var t=0,i=0;return e.forEach(function(e,n){var r=!e||"null"===e.toLowerCase();r&&n===t?t=n+1:r||(i=n)}),[t,i]}function p(e){var t=e.substring(0,e.indexOf("?")),i=t.split(".").pop();return i.toLowerCase()}Object.defineProperty(e,"__esModule",{value:!0}),e.getFileExtension=e.getTrimmedExtent=e.getNiceIntervals=e.getRoundedValue=e.stringToNumber=e.camelToHyphen=e.parseQueryString=e.parseChartId=e.getChartId=void 0;var g=i(t);e.getChartId=n,e.parseChartId=r,e.parseQueryString=s,e.camelToHyphen=o,e.stringToNumber=l,e.getRoundedValue=u,e.getNiceIntervals=d,e.getTrimmedExtent=f,e.getFileExtension=p}),define("scripts/PageData",["exports","../shared/utils"],function(e,t){function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=i(t),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(){function e(t){var i=this;n(this,e);var a=t.shift(),s=t.map(function(e){return a.reduce(function(t,i,n){return t[i]=e[n],t},{})});1!=a.length?!function(){var e=a.shift();i.indices=s.map(function(t){return t[e]})}():this.indices=s.map(function(e,t){return"Row "+(t+1)}),this.serieses=a.map(function(e,t){return{label:e,seriesIndex:t}}),this.data=a.map(function(e){return s.map(function(t,n){return{x:n,y:r.stringToNumber(t[e]),xLabel:i.indices[n],yRaw:t[e]}})})}return a(e,null,[{key:"fromJSON",value:function(t,i){var n=r.getFileExtension(t),a="tsv"==n?d3.tsv.parseRows(i):d3.csv.parseRows(i);return new e(a)}}]),e}();e.default=s}),define("scripts/ChartData",["exports","../shared/utils","./PageData"],function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=(n(i),function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}()),s=function(){function e(t,i){r(this,e),this._data=t.data.filter(function(e,t){return i.indexOf(t)>-1}),this._serieses=t.serieses.filter(function(e,t){return i.indexOf(t)>-1}),this._indices=t.indices,this.formatData()}return a(e,[{key:"formatData",value:function(){var e=this;this._data[0].forEach(function(t,i){var n=0,r=0;e._data.forEach(function(t,a){var s=e._data[a][i];s.ySeries=a,s.y<0?(n+=s.y,s.y0=n,s.y1=s.y0-s.y):(s.y0=r,s.y1=s.y0+s.y,r+=s.y)})})}},{key:"getFlattenedData",value:function(){return this._data.reduce(function(e,t){return e.concat(t)})}},{key:"getSerieses",value:function(){return this._serieses}},{key:"getSeries",value:function(e){return this._serieses[e]}},{key:"getDatum",value:function(e,t){return this._data[e][t]}},{key:"getSeriesLabels",value:function(){return this._serieses.map(function(e){return e.label})}},{key:"getSeriesIndices",value:function(){return this._serieses.map(function(e){return e.seriesIndex})}},{key:"getSeriesCount",value:function(){return this._serieses.length}},{key:"getUnstackedValuesAtIndex",value:function(e){return this._data.map(function(t){return t[e].y})}},{key:"getValuesForSeries",value:function(e){var t=this.getSeriesExtent(e);return this._data[e].slice(t[0],t[1]+1)}},{key:"getFirstDatum",value:function(e){var t=this.getSeriesExtent(e)[0];return this._data[e][t]}},{key:"getLastDatum",value:function(e){var t=this.getSeriesExtent(e)[1];return this._data[e][t]}},{key:"getSeriesExtent",value:function(e){var i=this._data[e].map(function(e){return e.yRaw});return(0,t.getTrimmedExtent)(i)}},{key:"getIndices",value:function(){return this._indices}},{key:"getIndexCount",value:function(){return this._indices.length}},{key:"getStackedExtent",value:function(){return d3.extent(this.getFlattenedData(),function(e){return e.y<0?e.y0:e.y1})}},{key:"getStackedExtentForIndex",value:function(e){var t=[0,0];return this._data.forEach(function(i){var n=i[e].y<0?0:1;t[n]+=i[e].y}),t}},{key:"getUnstackedExtent",value:function(){return d3.extent(this.getFlattenedData(),function(e){return e.y})}},{key:"getIndexExtent",value:function(){return[this._indices[0],this._indices[this._indices.length-1]]}}]),e}();e.default=s}),define("scripts/Editor",["exports"],function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=function(){function e(i){var n=this;t(this,e),this.rootElement=i,this.listener=function(){},this.setContent(this.getContent()),this.rootElement.addEventListener("focusout",function(){var e=n.getContent();n.setContent(e),n.listener(e)})}return i(e,[{key:"onChange",value:function(e){this.listener=e}},{key:"getContent",value:function(){var e=this.rootElement.innerText;return e?e.trim():""}},{key:"setContent",value:function(e){if(!e)return this.rootElement.innerHTML="",void this.rootElement.classList.add("empty");var t=document.createElement("div");t.innerHTML=e;var i=t.innerText,n=(i||"").split("\n").map(function(e){return"<div>"+e+"</div>"}).join("");this.rootElement.innerHTML=n,this.rootElement.classList.remove("empty")}}]),e}();e.default=n}),define("scripts/templates",["exports"],function(e){function t(){return'\n    <div class="page-settings">\n      <button class="option-item settings" title="Settings">\n        <span class="icon icon-settings"></span>\n      </button>\n\n      <div class="settings-popover popover">\n        <div class="page-options">\n          <a class="page-option-item download-data" title="Download data">\n            <span class="icon icon-download"></span>Download data\n          </a>\n\n          <button class="page-option-item toggle-color" title="Switch background color">\n            <span class="icon icon-color"></span>Switch background\n          </button>\n\n          <div class="grid-option"></div>\n\n          <button class="page-option-item get-embed" title="Get embed code">\n            <span class="icon icon-embed"></span>Get embed code\n          </button>\n\n          <div class="page-data-source">\n            <label>Update data source</label>\n            <div class="page-data-source-form">\n              <input class="data-source-url">\n              <button class="update-data-source">Go</button>\n            </div>\n          </div>\n        </div>\n\n        <a href="/" class="page-option-item">\n          <span class="icon icon-back"></span>Charted home\n        </a>\n      </div>\n    </div>\n  '}function i(e){var t='<script src="'+window.location.origin+'/embed.js" data-charted="'+e+'"></script>';return'\n    <div class="overlay-container">\n      <div class="overlay-content">\n        <h1 class="overlay-title">Embed this Charted page</h1>\n        <p class="overlay-description">\n          You can add this embed to your website by copying and pasting the HTML code below.\n        </p>\n\n        <textarea class="embed-link">'+t+'</textarea>\n        <div class="iframe-container">'+t+'</div>\n      </div>\n      <div class="overlay-close"><span class="icon icon-x"></span></div>\n    </div>\n  '}function n(){return'\n    <button class="page-option-item toggle-grid" title="Show full width charts">\n      <span class="icon icon-full-screen"></span>Show full width charts\n    </button>\n  '}function r(){return'\n    <button class="page-option-item toggle-grid" title="Show split-screen charts">\n      <span class="icon icon-split-screen"></span>Show split-screen charts\n    </button>\n  '}function a(e){return'\n    <div class="y-axis-label" style="top:'+e.top+'px">'+e.display+"</div>\n  "}function s(e){var t="",i="";return e.editable&&(t='contenteditable="true"',i='\n      <div class="chart-options">\n        <a class="option-item toggle-type" href="#" title="Switch chart type">\n          <span class="icon icon-line"></span>\n          <span class="icon icon-column"></span>\n        </a>\n\n        <a class="option-item toggle-rounding" href="#" title="Turn rounding on/off">\n          <span class="icon icon-round-off"></span>\n          <span class="icon icon-round-on"></span>\n        </a>\n      </div>\n    '),'\n    <div class="chart show-columns">\n      <div class="chart-description">\n        <h1 class="js-chartTitle title info-input" '+t+'></h1>\n        <div class="js-chartNote note info-input" '+t+'></div>\n      </div>\n\n      <div class="chart-plot-outer-container">\n        <div class="chart-plot-inner-container">\n          <div class="y-axis-container"><div class="y-axis chart-height"></div></div>\n          <div class="zero-line-container chart-height"><div class="zero-line"></div></div>\n          <div class="x-axis"><span class="x-beginning"></span><span class="x-end"></span></div>\n          <div class="selection">\n            <div class="selection-info">\n              <div class="selection-value"></div>\n              <div class="selection-xlabel"></div>\n              <div class="selection-ylabel"></div>\n            </div>\n          </div>\n          <figure class="chart-plot chart-height"></figure>\n        </div>\n      </div>\n\n      <aside class="chart-info">\n        <ul class="legend hidden"></ul>\n        '+i+"\n      </aside>\n    </div>\n  "}function o(e){return'\n    <div class="change-series-color popover">\n      <p>Change color:</p>\n      <p>\n        <span contenteditable="true" class="color-hex-input change-series-color-'+e.seriesIndex+'">\n          '+e.colorHex+'\n        </span>\n      </p>\n      <span class="arrow-bottom-left"></span>\n    </div>\n  '}function l(e){var t="",i="";return e.editable&&(t='contenteditable="true"',i='<button class="move-chart"><span class="icon icon-move"></span></button>'),'\n    <li class="legend-item">\n      <div class="legend-label info-input">\n        <span class="legend-input js-legendLabel" '+t+">"+e.label+'</span>\n      </div>\n      <button class="legend-color">\n        <span style="background-color:'+e.color+';" class="legend-dot"></span>\n      </button>\n      '+i+"\n    </li>\n  "}function c(e){var t=e.otherCharts.map(function(e){return'\n      <a href= "#" class="move-chart-option move-to-chart-'+e.chartIndex+'">\n        '+e.title+"\n      </a>\n    "}).join("\n"),i="";return e.series.length>1&&(i='\n      <a href= "#" class="move-chart-option move-to-new-chart">\n        <span class="icon icon-plus"></span>New chart\n      </a>\n    '),'\n    <div class="move-chart-options popover">\n      <p>Move to:</p>\n      '+t+"\n      "+i+'\n      <span class="arrow-bottom-right"></span>\n    </div>\n  '}Object.defineProperty(e,"__esModule",{value:!0}),e.pageSettings=t,e.embedOverlay=i,e.gridSettingsFull=n,e.gridSettingsSplit=r,e.yAxisLabel=a,e.chart=s,e.changeSeriesColor=o,e.legendItem=l,e.moveChart=c}),define("scripts/ChartLegend",["exports","./Chart","./ChartData","./PageController","./Editor","./templates"],function(e,t,i,n,r,a){function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);
return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var c=(o(t),o(i),o(r)),u=s(a),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),d=function(){function e(t,i,n){l(this,e),this.chart=n,this.controller=t,this.data=i,this.chartIndex=this.chart.getChartIndex(),this.$container=this.chart.getChartContainer(),this.series=this.chart.getChartSeries()}return h(e,[{key:"update",value:function(){var e=this;if(1===this.data.getSeriesCount()&&0===this.controller.getOtherCharts(this.chartIndex).length)return void this.$container.find(".legend").html("");for(var t=$(""),i=this.data.getSerieses(),n=i.length-1;n>=0;n--){var r=i[n],a=this.controller.getSeriesName(this.series[n]),s=$(u.legendItem({label:a,color:this.chart.getSeriesColor(r.seriesIndex),editable:this.controller.getEditability()}));t=t.add(s),r.legendEl=s}this.$container.find(".legend").html(t).removeClass("hidden");var o=this.controller.params.seriesNames;this.controller.getEditability()&&(this.data.getSerieses().forEach(function(t){var i=t.legendEl.find(".js-legendLabel").get(0),n=new c.default(i);n.onChange(function(i){""===!i||i===t.label?(n.setContent(t.label),delete o[t.seriesIndex]):o[t.seriesIndex]=i,e.controller.updateURL()})}),this.bindLegendInteractions())}},{key:"bindLegendInteractions",value:function(){var e=this;this.data.getSerieses().forEach(function(t,i){t.legendEl.find(".legend-color").click(function(i){i.stopPropagation(),e.removePopovers(),e.openColorInput(t)}),t.legendEl.find(".move-chart").click(function(n){n.stopPropagation(),e.removePopovers(),e.openMoveChart(t,i)})}),$("html").click(function(){return e.removePopovers()})}},{key:"openColorInput",value:function(e){var t=this,i=this.chart.getSeriesColor(e.seriesIndex).replace(/^#/,"");e.legendEl.addClass("active-color-input"),e.legendEl.append(u.changeSeriesColor({colorHex:i,seriesIndex:e.seriesIndex})),this.data.getSeriesIndices().forEach(function(e){var i=t.$container.find(".change-series-color-"+e);i.on("focusout",function(){var n=t.controller.params.seriesColors,r="#"+i.text().replace(/^#/,"").trim(),a=t.chart.getDefaulSeriesColor(e),s=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(r);r!==a&&s?n[e]=r:(i.text(a),delete n[e]),t.chart.render(),t.controller.updateURL()})}),this.$container.find(".change-series-color").click(function(e){return e.stopPropagation()})}},{key:"openMoveChart",value:function(e,t){var i=this,n=this.controller.getOtherCharts(this.chartIndex),r=n.length+1;0===n.length?this.controller.moveToChart(this.series[t],this.chartIndex,r):1===n.length&&1===this.series.length?this.controller.moveToChart(this.series[t],this.chartIndex,n[0].chartIndex):(e.legendEl.addClass("active"),e.legendEl.append(u.moveChart({otherCharts:n,series:this.series})),n.forEach(function(e){i.$container.find(".move-to-chart-"+e.chartIndex).click(function(n){n.preventDefault(),i.controller.moveToChart(i.series[t],i.chartIndex,e.chartIndex)})}),this.$container.find(".move-to-new-chart").click(function(){i.controller.moveToChart(i.series[t],i.chartIndex,r)}))}},{key:"removePopovers",value:function(){$("html").find(".move-chart-options, .change-series-color").remove(),$("html").find(".page-settings").removeClass("open"),$("html").find(".legend-item").removeClass("active active-color-input")}}]),e}();e.default=d}),define("scripts/Chart",["exports","./ChartData","./ChartLegend","../shared/utils","./PageController","./PageData","./Editor","./templates"],function(e,t,i,n,r,a,s,o){function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var h=c(t),d=c(i),f=(c(a),c(s)),p=l(o),g=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),m=function(){function e(t,i,n,r,a){var s=this;u(this,e),this.pageController=t,this.$wrapper=n;var o={editable:t.getEditability()};this.$wrapper.html(p.chart(o)),this.$container=n.find(".chart").first(),this.$plot=this.$container.find(".chart-plot").first(),this.$xBeg=this.$container.find(".x-beginning"),this.$xEnd=this.$container.find(".x-end"),this.$selectionElem=this.$container.find(".selection"),this.$selectionXLabel=this.$container.find(".selection-xlabel"),this.$selectionYLabel=this.$container.find(".selection-ylabel"),this.$yAxis=this.$container.find(".y-axis"),this.$zeroLine=this.$container.find(".zero-line"),this.$selectionValue=this.$container.find(".selection-value"),this.$optionsElem=this.$container.find(".chart-options"),this.$pageSettings=$(".page-settings"),this.$chartDescription=this.$container.find(".chart-description"),this.titleEditor=new f.default(this.$container.find(".js-chartTitle").get(0)),this.titleEditor.onChange(function(e){return e?(s.params.title=e,void s.pageController.updateURL()):(s.params.title=s.pageController.getDefaultTitle(s.chartIndex),void s.titleEditor.setContent(s.params.title))}),this.noteEditor=new f.default(this.$container.find(".js-chartNote").get(0)),this.noteEditor.onChange(function(e){s.params.note=e,s.pageController.updateURL()}),this.refresh(i,r,a),this.bindInteractions()}return g(e,[{key:"refresh",value:function(e,t,i){this.chartIndex=e,this.params=t,this.data=new h.default(i,this.params.series),this.legend=new d.default(this.pageController,this.data,this),this.setupChart(),this.render()}},{key:"setupChart",value:function(){this.$plot.empty(),this.titleEditor.setContent(this.params.title),this.noteEditor.setContent(this.params.note),this.$xBeg.html(this.data.getIndexExtent()[0]),this.$xEnd.html(this.data.getIndexExtent()[1]),this.setScales(),this.createChartElements()}},{key:"setScales",value:function(){var e=this;this.xScale=d3.scale.linear().domain([0,this.data.getIndexCount()]),this.xPosition=function(t){return Math.floor(e.xScale(t.x),0)},this.xBarWidth=function(t){var i=e.plotWidth/e.data.getIndexCount()>=8?1:0,n=t.x+1<e.data.getIndexCount()?e.xScale(t.x+1):e.plotWidth;return Math.floor(n,0)-e.xPosition(t)-i},this.xPositionLine=function(t){return e.xPosition(t)+.5*e.xBarWidth(e.data.getDatum(0,t.x))},this.yScale=d3.scale.linear(),this.yPosition=function(t){return e.yScale(t.y)},this.yPositionStacked=function(t){return e.yScale(t.y1)},this.yHeightStacked=function(t){return 0===t.y?0:e.yScale(t.y0)-e.yScale(t.y1)+1},this.yRangeStacked=this.data.getStackedExtent(),this.yRangeUnstacked=this.data.getUnstackedExtent(),this.colorLight="#333333",this.colorDark="#FFFFFF",this.colorRange=["#6DCC73","#1D7775","#4FCFD5","#FCE651","#FF7050","#FFC050","#999999"]}},{key:"createChartElements",value:function(){this.svg=d3.select(this.$plot.get(0)).append("svg"),this.line=d3.svg.line().interpolate("cardinal").tension(.96).x(this.xPositionLine).y(this.yPosition),this.layerGroup=this.svg.append("g").attr("class","layers"),this.layers=this.layerGroup.selectAll("g").data(this.data.getSeriesIndices()).enter().append("g").attr("class","layer");var e=this;this.layers.each(function(t,i){var n=d3.select(this);n.append("path").attr("class","line").each(function(){e.data.getSeries(i).lineEl=this}),n.selectAll("rect").data(e.data.getValuesForSeries(i)).enter().append("rect").attr("class","column").each(function(t){e.data.getDatum(i,t.x).columnEl=this}),n.append("circle").attr("class","end-dot last-dot").attr("r",3),n.append("circle").attr("class","end-dot first-dot").attr("r",3),n.append("circle").attr("class","selected-dot").attr("r",4)})}},{key:"updateSizes",value:function(){this.margin={top:4,right:4,bottom:0,left:0},this.width=this.$plot.width(),this.plotWidth=this.width-this.margin.right-this.margin.left,this.height=this.$plot.height(),this.svg.attr("width",this.width).attr("height",this.height),this.xScale.range([this.margin.left,this.width-this.margin.right-this.margin.left]),this.yScale.range([this.height-this.margin.bottom,this.margin.top]),this.xEndEdge=this.$xEnd.offset().left-this.$plot.offset().left,this.xBegEdge=this.$xBeg.offset().left-this.$plot.offset().left+this.$xBeg.width()}},{key:"render",value:function(){this.updateSizes(),"off"===this.params.rounding?this.$container.addClass("rounding-off"):this.$container.removeClass("rounding-off"),this.selectedX=this.data.getIndexCount()-1,this.applyChartColors(),this.applyChartType(),this.updateYAxis(),this.plotAll(),this.updateSelectedX(),this.legend.update()}},{key:"getDefaulSeriesColor",value:function(e){var t=this.data.getSeriesIndices();if(1===t.length)return this.pageController.params.isLight()?this.colorLight:this.colorDark;var i=t.indexOf(e),n=this.colorRange.length,r=i%n;return this.colorRange[r]}},{key:"getSeriesColor",value:function(e){return this.pageController.params.getSeriesColor(e)||this.getDefaulSeriesColor(e)}},{key:"applyChartColors",value:function(){var e=this;this.layers.each(function(t){var i=d3.select(this);i.selectAll(".line").attr("stroke",e.getSeriesColor(t)),i.selectAll(".column, .selected-column, .selected-dot, .end-dot").attr("fill",e.getSeriesColor(t))})}},{key:"applyChartType",value:function(){if("column"===this.params.type)this.$container.addClass("show-columns"),this.yRange=this.yRangeStacked,this.focusedSeriesIndex=this.data.getSeriesCount();else{this.$container.removeClass("show-columns"),this.yRange=this.yRangeUnstacked;var e=this.data.getUnstackedValuesAtIndex(this.selectedX);this.focusedSeriesIndex=e.indexOf(d3.max(e))}var t=function(e){var t=e[0]<0?1.1*e[0]:0;return[t,Math.max(0,e[1])]};this.yScale.domain(t(this.yRange))}},{key:"plotAll",value:function(){var e=this;this.layers.each(function(t,i){var n=d3.select(this);n.selectAll(".column").attr("x",e.xPosition).attr("y",e.yPositionStacked).attr("height",e.yHeightStacked).attr("width",e.xBarWidth),n.selectAll(".line").attr("d",e.line(e.data.getValuesForSeries(i)));var r=e.data.getFirstDatum(i),a=e.data.getLastDatum(i);n.selectAll(".last-dot").attr("cx",e.xPositionLine(a)).attr("cy",e.yPosition(a)),n.selectAll(".first-dot").attr("cx",e.xPositionLine(r)).attr("cy",e.yPosition(r))})}},{key:"updateYAxis",value:function(){var e=this,t="",i=(0,n.getNiceIntervals)(this.yRange,this.height),r=this.$yAxis.height()-this.$container.height()+60;i.forEach(function(i){i.top=e.yScale(i.value),i.top>=r&&(i.display="on"===e.params.rounding?i.displayString:i.rawString,t+=p.yAxisLabel(i))}),this.$yAxis.html(t),this.$zeroLine.removeClass("hidden").css("top",this.yScale(0))}},{key:"updateSelectedX",value:function(e){void 0!=e&&(this.selectedX=e);var t=this.xPosition(this.data.getDatum(0,this.selectedX)),i=.5*this.xBarWidth(this.data.getDatum(0,this.selectedX)),n=t+i;this.$selectionElem.css("left",n);var r=n,a=n+this.$selectionXLabel.width();n<this.width/2?this.$selectionElem.addClass("on-right"):(this.$selectionElem.removeClass("on-right"),r=n-this.$selectionXLabel.width(),a=n),r<=this.xBegEdge?this.$xBeg.addClass("hidden"):this.$xBeg.removeClass("hidden"),a>=this.xEndEdge?this.$xEnd.addClass("hidden"):this.$xEnd.removeClass("hidden");var s=this;this.layers.each(function(e,t){var i=s.data.getSeriesExtent(t);s.selectedX>=i[0]&&s.selectedX<=i[1]?d3.select(this).selectAll(".selected-dot").attr("cx",s.xPositionLine(s.data.getDatum(t,s.selectedX))).attr("cy",s.yPosition(s.data.getDatum(t,s.selectedX))).style({opacity:"1"}):d3.select(this).selectAll(".selected-dot").style({opacity:"0"})});for(var o=this.data.getIndexCount(),l=0;l<o;l++){var c="column";s.selectedX===l&&(c="column selected");for(var u=0;u<s.data.getSeriesCount();u++){var h=s.data.getDatum(u,l).columnEl;h&&d3.select(h).attr("class",c)}}this.updateSelectionText()}},{key:"updateSelectionText",value:function(){var e=this.focusedSeriesIndex>=this.data.getSeriesCount(),t=e?this.data.getSeriesCount()-1:this.focusedSeriesIndex,i=this.data.getDatum(t,this.selectedX),r="",a=this.pageController.params.isLight()?this.colorLight:this.colorDark;if(e||null!=i.ySeries&&(a=this.getSeriesColor(this.data.getSeries(i.ySeries).seriesIndex)),this.data.getSeriesCount()>1){var s=this.getChartSeries()[t];r=e?"total":this.pageController.getSeriesName(s)}var o=this.data.getStackedExtentForIndex(this.selectedX),l=o[1]+o[0],c=e?l:(0,n.stringToNumber)(i.yRaw),u="on"===this.params.rounding?(0,n.getRoundedValue)(c,this.yRange):c;this.$selectionYLabel.text(r).css("color",a),this.$selectionXLabel.text(i.xLabel),this.$selectionValue.text(u).css("color",a)}},{key:"bindInteractions",value:function(){var e=this;Object.keys(r.OPTIONS).forEach(function(t){e.$container.find(".toggle-"+t).click(function(i){i.preventDefault();var n=r.OPTIONS[t];e.params[t]=e.params[t]===n[0]?n[1]:n[0],e.render(),e.pageController.updateURL()})}),this.$container.mousemove(function(t){return e.handleMouseover(t)})}},{key:"handleMouseover",value:function(e){var t=this;if(this.$container.addClass("active"),$("body").addClass("page-active"),this.mouseTimer&&(clearTimeout(this.mouseTimer),this.mouseTimer=null),this.mouseTimer=setTimeout(function(){t.$optionsElem.length&&t.$optionsElem.is(":hover")||t.$chartDescription.length&&t.$chartDescription.is(":hover")||t.$pageSettings.length&&t.$pageSettings.is(":hover")||(t.$container.removeClass("active"),$("body").removeClass("page-active"),t.$pageSettings.removeClass("open"))},1e3),!(e.pageY-this.$plot.offset().top>this.$plot.height())){var i=this.getClosestPoint(e);i.selectedX===this.selectedX&&i.focusedSeriesIndex===this.focusedSeriesIndex||(this.selectedX=i.selectedX,this.focusedSeriesIndex=i.focusedSeriesIndex,this.updatefocusedSeriesIndex(),this.pageController.updateSelectedX(this.selectedX))}}},{key:"getClosestPoint",value:function(e){var t=this,i=(e.pageX-this.$plot.offset().left)*this.data.getIndexCount()/(this.width-this.margin.right),n=e.pageY-this.$plot.offset().top,r=Math.min(Math.floor(Math.max(i,0)),this.data.getIndexCount()-1),a=this.focusedSeriesIndex,s=d3.range(this.data.getSeriesCount()).map(function(e){var i=t.data.getDatum(e,r),a="line"===t.params.type?t.yPosition(i):t.yPositionStacked(i),s="line"===t.params.type?Math.abs(n-a):n-a,o="line"===t.params.type||s>0;return{diff:s,series:e,isValid:o}});if(s=s.filter(function(e){return e.isValid}),s.sort(function(e,t){return d3.ascending(e.diff,t.diff)}),a=s.length?s[0].series:0,"column"===this.params.type){var o=this.data.getStackedExtentForIndex(r),l=[this.yScale(o[0]),this.yScale(o[1])];(n<=l[1]||n>l[0])&&(a=this.data.getSeriesCount())}return{selectedX:r,focusedSeriesIndex:a}}},{key:"updatefocusedSeriesIndex",value:function(){if("line"===this.params.type){this.$container.find(".line").attr("class","line");var e=d3.select(this.data.getSeries(this.focusedSeriesIndex).lineEl);e.attr("class","line focused"),d3.select(e.node().parentNode).each(function(){this.parentNode.appendChild(this)})}}},{key:"getChartIndex",value:function(){return this.chartIndex}},{key:"getChartContainer",value:function(){return this.$container}},{key:"getChartSeries",value:function(){return this.params.series}}]),e}();e.default=m}),define("scripts/ChartParameters",["exports","../shared/utils","../shared/sha1"],function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=r(t),o=(n(i),function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}()),l="dark",c="light",u="full",h="split",d={type:["column","line"],rounding:["on","off"]},f=function(){function e(t){a(this,e),this.url=t,this.charts=[{}],this.seriesColors={},this.seriesNames={},this._color=c,this._grid=h,this._getDefaultTitle=function(e){return""}}return o(e,[{key:"withDefaultTitle",value:function(e){return this._getDefaultTitle=e,this}},{key:"isLight",value:function(){return this._color==c}},{key:"toggleColor",value:function(){this._color=this.isLight()?l:c}},{key:"isFull",value:function(){return this._grid==u}},{key:"toggleGrid",value:function(){this._grid=this.isFull()?h:u}},{key:"getSeriesColor",value:function(e){return this.seriesColors[e]}},{key:"getSeriesName",value:function(e){return this.seriesNames[e]}},{key:"compress",value:function(){var e=this,t={dataUrl:this.url};return Object.keys(this.seriesNames).length&&(t.seriesNames=this.seriesNames),Object.keys(this.seriesColors).length&&(t.seriesColors=this.seriesColors),this.isLight()||(t.color=this._color),this.isFull()&&(t.grid=this._grid),t.charts=this.charts.map(function(t,i){var n={};return Object.keys(d).forEach(function(e){t[e]&&t[e]!==d[e][0]&&(n[e]=t[e])}),t.title&&t.title!==e._getDefaultTitle(i)&&(n.title=t.title),t.note&&(n.note=t.note),i>0&&t.series&&(n.series=t.series),n}),1!==t.charts.length||Object.keys(t.charts[0]).length||delete t.charts,t}}],[{key:"fromJSON",value:function(t){var i=new e(t.dataUrl);return t.charts&&(i.charts=t.charts),t.seriesNames&&(i.seriesNames=t.seriesNames),t.seriesColors&&(i.seriesColors=t.seriesColors),t.grid&&(i._grid=t.grid),t.color&&(i._color=t.color),i}},{key:"fromQueryString",value:function(t){var i=s.parseQueryString(t),n=i.data;if(!n)return null;var r=n.csvUrl||n.dataUrl;if(!r)return null;var a=new e(r);return n.charts&&(a.charts=n.charts),n.seriesNames&&(a.seriesNames=n.seriesNames),n.seriesColors&&(a.seriesColors=n.seriesColors),n.grid&&(a._grid=n.grid),n.color&&(a._color=n.color),a}}]),e}();e.default=f}),define("scripts/PageController",["exports","./PageData","./Chart","./ChartParameters","./templates","../shared/utils"],function(e,t,i,n,r,a){function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.PageController=e.OPTIONS=void 0;var c=o(t),u=o(i),h=o(n),d=s(r),f=s(a),p=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),g=18e5,m=e.OPTIONS={type:["column","line"],rounding:["on","off"]};e.PageController=function(){function e(){var t=this;l(this,e),this.isEmbed=!1,this.chartObjects=[],this.$body=$("body"),this.$charts=$(".charts"),$(window).resize(function(){clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){return t.setDimensions()},30)}),$(document).keyup(function(e){27==e.keyCode&&($(".overlay-container").remove(),$(".page-settings").removeClass("open"))}),$(".load-data-form").submit(function(e){e.preventDefault();var i=$(".data-file-input").val();if(!i){var n="You’ll need to paste in the URL to a .csv file or Google Spreadsheet first.";return void t.errorNotify(new Error(n))}t.fetchPageData(i,null,null)})}return p(e,[{key:"activate",value:function(){var e=this,t=/\/(c|embed)\/([a-z\d]{7})\/?$/.exec(window.location.pathname),i=t&&t[2],n=h.default.fromQueryString(window.location.search||"");return i||n?(this.isEmbed=t&&"embed"==t[1],this.isEmbed||setInterval(function(){return e.fetchPageData()},g),i?void this.fetchPageData(null,i,null):void(n&&!function(){e.params=n.withDefaultTitle(function(t){return e.getDefaultTitle(t)});var t=e.params.compress(),i=t.dataUrl||null;e.updateURL(function(){return e.fetchPageData(i,null,t)})}())):(this.clearExisting(),void this.$body.addClass("pre-load"))}},{key:"fetchPageData",value:function(e,t,i){var n=this;if(!e&&!t){if(!this.params)return;t=f.getChartId(this.params.compress())}this.$body.addClass("loading"),this.updatePageTitle("Charted (...)"),this.clearExisting(),e&&$(".data-file-input").val(e);var r="/load/?url="+encodeURIComponent(e||"")+"&id="+encodeURIComponent(t||"");d3.json(r,function(e,t){if(e)return void n.errorNotify(e);if(!t.data||!t.data.length)return void n.errorNotify(new Error("Missing data from source: "+t.params.dataUrl));var r=i?i:t.params;r.dataUrl=t.params.dataUrl,n.params=h.default.fromJSON(r).withDefaultTitle(function(e){return n.getDefaultTitle(e)}),n.data=new c.default.fromJSON(n.params.url,t.data),n.render()})}},{key:"render",value:function(){var e=this,t=this.params.isLight()?"light":"dark";this.$body.addClass(t),this.applyEmbed(),this.setupPageSettings(),this.params.charts[0].title||(this.params.charts[0].title=this.data.serieses.length>1?"Chart":this.data.serieses[0].label),this.$body.removeClass("pre-load loading error"),this.params.charts.forEach(function(t,i){return e.updateChart(i)}),this.setDimensions(),this.updateURL(),$(".data-source-url").val(this.params.url)}},{key:"clearExisting",value:function(){$(".chart-wrapper, .page-settings").remove(),this.chartObjects=[],$("body, .settings, .settings-popover, .toggle-color").unbind()}},{key:"setupPageSettings",value:function(){var e=this;if(!this.isEmbed){this.$body.append(d.pageSettings());var t=this.$body.find(".page-settings");$(".download-data").attr("href",this.params.url),$(".data-source-url").val(this.params.url),t.find(".settings").click(function(e){e.stopPropagation(),t.addClass("open")}),t.find(".settings-popover").click(function(e){return e.stopPropagation()}),this.$body.click(function(){return t.removeClass("open")}),t.find(".toggle-color").click(function(){return e.toggleColor()}),t.find(".get-embed").click(function(){return e.getEmbed()}),t.find(".update-data-source").click(function(){return e.fetchPageData($(".data-source-url").val(),null,e.params)})}}},{key:"updateChart",value:function(e){var t=this.getFullParams(e);0===t.series.length?this.removeChart(e):e<=this.chartObjects.length-1?this.chartObjects[e].refresh(e,t,this.data):this.createNewChart(e,this.getFullParams(e))}},{key:"getFirstChartSeries",value:function(){for(var e=[],t=[],i=1;i<this.params.charts.length;i++)e=e.concat(this.params.charts[i].series);for(var n=0;n<this.data.serieses.length;n++)e.indexOf(n)>-1||t.push(n);return t}},{key:"createNewChart",value:function(e,t){var i=$('<div class="chart-wrapper"></div>'),n=this.getChartDimensions();i.outerHeight(n.height).outerWidth(n.width),this.$charts.append(i),this.chartObjects.push(new u.default(this,e,i,t,this.data))}},{key:"moveToChart",value:function(e,t,i){var n=this,r=this.params.charts[t],a=this.params.charts[i];this.params.charts.forEach(function(e,t){e.title&&e.title==n.getDefaultTitle(t)&&delete e.title}),i>this.params.charts.length-1?this.params.charts.push({series:[e]}):i>0&&(a.series.push(e),a.series.sort(function(e,t){return e-t})),t>0&&(r.series=r.series.filter(function(t){return t!==e})),this.updateChart(i),$("html, body").animate({scrollTop:this.chartObjects[i].$wrapper.offset().top},300),this.updateChart(t);for(var s=t;s<this.chartObjects.length;s++)s!==i&&this.updateChart(s);this.setDimensions(),this.updateURL()}},{key:"removeChart",value:function(e){for(var t=e+1;t<this.chartObjects.length;t++)this.chartObjects[t].chartIndex--;this.params.charts.splice(e,1),this.chartObjects[e].$wrapper.remove(),this.chartObjects.splice(e,1)}},{key:"getFullParams",value:function(e){var t=this.params.charts[e];return Object.keys(m).forEach(function(e){t[e]=t[e]||m[e][0]}),0===e&&(t.series=this.getFirstChartSeries()),t.title=t.title||this.getDefaultTitle(e),t}},{key:"getDefaultTitle",value:function(e){var t=this.params.charts[e].series;if(!t||!this.data)return"Charted";if(1===t.length)return this.getSeriesName(t[0]);var i=this.params.charts.filter(function(t,i){return t.series.length>0&&i<e});return 0===e?"Chart":"Chart "+(1+i.length)}},{key:"getSeriesName",value:function(e){return this.params.getSeriesName(e)||this.data.serieses[e].label}},{key:"getChartCount",value:function(){return this.params.charts.length}},{key:"getOtherCharts",value:function(e){var t=this;return this.params.charts.map(function(e,i){return{title:e.title||t.getDefaultTitle(i),chartIndex:i}}).filter(function(t,i){return i!==e})}},{key:"updateSelectedX",value:function(e){this.chartObjects.forEach(function(t){t.updateSelectedX(e)})}},{key:"toggleColor",value:function(){this.params.toggleColor(),this.$body.toggleClass("dark"),this.chartObjects.forEach(function(e){e.render()}),this.updateURL()}},{key:"toggleGrid",value:function(){this.params.toggleGrid(),this.applyGrid(),this.setDimensions(),this.updateURL()}},{key:"applyGrid",value:function(){var e=this;this.$body.toggleClass("full");var t=d.gridSettingsFull;this.params&&this.params.isFull()&&(t=d.gridSettingsSplit);var i=this.chartObjects?this.chartObjects.length:0;$(".grid-option").html(i>1?t():""),$(".toggle-grid").click(function(){return e.toggleGrid()})}},{key:"getEmbed",value:function(){var e=this.params.compress(),t=f.getChartId(e);this.$body.append(d.embedOverlay(t)),this.$body.find(".overlay-content").click(function(e){return e.stopPropagation()}),this.$body.click(function(){return $(".overlay-container").remove()})}},{key:"applyEmbed",value:function(){this.params.embed?this.$body.addClass("embed"):this.$body.removeClass("embed")}},{key:"getEditability",value:function(){return!this.isEmbed}},{key:"getChartDimensions",value:function(){var e=600,t=1200,i=800,n=$(window).innerWidth(),r="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,a=n>i?r:"auto",s=this.chartObjects?this.chartObjects.length:0,o=s>=2&&n>t&&!this.params.isFull(),l=r>e&&n>i,c=s>=3||2===s&&!o,u=l&&c;return{width:o?n/2:n,height:u?r/2:a,isHalfHeight:u,isGrid:o}}},{key:"setDimensions",value:function(){var e=this.getChartDimensions();e.isGrid?(this.$body.addClass("chart-grid"),this.$body.removeClass("half-height")):e.isHalfHeight?(this.$body.removeClass("chart-grid"),this.$body.addClass("half-height")):this.$body.removeClass("chart-grid half-height"),$(".chart-wrapper").outerHeight(e.height).outerWidth(e.width);var t=2*Math.floor((this.chartObjects.length-1)/2);this.chartObjects.forEach(function(i,n){e.isGrid&&n>=t?i.$wrapper.addClass("bottom-row"):i.$wrapper.removeClass("bottom-row"),i.render()}),this.applyGrid(),this.maybeBroadcastDimensions()}},{key:"maybeBroadcastDimensions",value:function(){if(this.isEmbed){var e=window.location.toString().replace("/c/","/embed/"),t=document.body.scrollHeight;t=t>600&&document.body.offsetWidth>=800?600:t;var i={chartId:f.getChartId(this.params.compress()),src:e,context:"iframe.resize",height:t};window.parent&&window.parent.postMessage(JSON.stringify(i),"*")}}},{key:"errorNotify",value:function(e){this.$body.addClass("error").removeClass("loading"),this.updatePageTitle();var t=e.message||e.responseText||"There’s been an error. Please check that you are using a valid .csv file. If you are using a Google Spreadsheet or Dropbox link, the privacy setting must be set to shareable.";$(".error-message").html(t)}},{key:"updateURL",value:function(e){this.updatePageTitle();var t=this.params.compress(),i=f.getChartId(t),n="/c/"+i;window.history.pushState({},null,n),d3.xhr(n).header("Content-Type","application/json").post(JSON.stringify(t),function(){e&&e()})}},{key:"updatePageTitle",value:function(e){var t=this,i="Charted",n=[];this.params&&this.params.charts&&(n=this.params.charts),e?i=e:n.length>0&&(i=n.map(function(e,i){return e.title||t.getDefaultTitle(i)}).join(", "),"Chart"===i&&(i+=" of "+n[0].series.map(function(e){return t.getSeriesName(e)}).join(", "))),document.title=i}}]),e}()}),define("scripts/charted",["./PageController"],function(e){$(function(){var t=new e.PageController;t.activate()})});